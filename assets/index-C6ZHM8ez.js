const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/signing-CfKKXaPb.js","assets/index-CC8cb4f7.js","assets/index-CjCS5sN2.css","assets/concat-hex-Brg9GlJN.js","assets/Signature-RewC2Zg_.js","assets/send-eip712-transaction-BTMkQrb9.js","assets/eth_sendRawTransaction-DPdnXbFR.js"])))=>i.map(i=>d[i]);
import{B as St,S as rt,T as Ct,U as Ut,V as S,W as It,X as J,Y as it,Z as ot,$ as ct,a0 as Ft,a1 as Q,a2 as _t,a3 as dt,a4 as ut,a5 as pt,a6 as Nt,a7 as Vt,a8 as R,a9 as $t,aa as D,ab as $,ac as Bt,r as Ht,ad as mt,ae as yt,af as lt,ag as Rt,ah as Mt,j,M as ft,ai as C,aj as x,ak as L,i as gt,al as z,am as b,g as ht,s as I,an as v,ao as K,ap as W,aq as F,ar as kt,as as qt,at as jt,au as O,av as zt,aw as Kt,ax as Wt,ay as At,az as wt,aA as Zt,aB as Yt,aC as Xt,aD as Jt,aE as Qt,d as te,p as ee,h as U,t as _,_ as tt,aF as ae,aG as ne,aH as se,aI as re}from"./index-CC8cb4f7.js";import{t as ie,p as oe,s as ce}from"./send-eip712-transaction-BTMkQrb9.js";class de extends St{constructor(a){super(`Filter type "${a}" is not supported.`,{name:"FilterTypeNotSupportedError"})}}const B=rt;function ue(t){const{abi:a,args:e=[],name:r}=t,o=Ct(r,{strict:!1}),n=a.filter(s=>o?s.type==="function"?Ut(s)===r:s.type==="event"?B(s)===r:!1:"name"in s&&s.name===r);if(n.length===0)return;if(n.length===1)return n[0];let i;for(const s of n){if(!("inputs"in s))continue;if(!e||e.length===0){if(!s.inputs||s.inputs.length===0)return s;continue}if(!s.inputs||s.inputs.length===0||s.inputs.length!==e.length)continue;if(e.every((d,p)=>{const m="inputs"in s&&s.inputs[p];return m?M(d,m):!1})){if(i&&"inputs"in i&&i.inputs){const d=Gt(s.inputs,i.inputs,e);if(d)throw new It({abiItem:s,type:d[0]},{abiItem:i,type:d[1]})}i=s}}return i||n[0]}function M(t,a){const e=typeof t,r=a.type;switch(r){case"address":return S(t,{strict:!1});case"bool":return e==="boolean";case"function":return e==="string";case"string":return e==="string";default:return r==="tuple"&&"components"in a?Object.values(a.components).every((o,n)=>M(Object.values(t)[n],o)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(r)?e==="number"||e==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(r)?e==="string"||t instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(r)?Array.isArray(t)&&t.every(o=>M(o,{...a,type:r.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function Gt(t,a,e){for(const r in t){const o=t[r],n=a[r];if(o.type==="tuple"&&n.type==="tuple"&&"components"in o&&"components"in n)return Gt(o.components,n.components,e[r]);const i=[o.type,n.type];if(i.includes("address")&&i.includes("bytes20")?!0:i.includes("address")&&i.includes("string")?S(e[r],{strict:!1}):i.includes("address")&&i.includes("bytes")?S(e[r],{strict:!1}):!1)return i}}const et="/docs/contract/encodeEventTopics";function pe(t){var c;const{abi:a,eventName:e,args:r}=t;let o=a[0];if(e){const d=ue({abi:a,name:e});if(!d)throw new J(e,{docsPath:et});o=d}if(o.type!=="event")throw new J(void 0,{docsPath:et});const n=it(o),i=B(n);let s=[];if(r&&"inputs"in o){const d=(c=o.inputs)==null?void 0:c.filter(m=>"indexed"in m&&m.indexed),p=Array.isArray(r)?r:Object.values(r).length>0?(d==null?void 0:d.map(m=>r[m.name]))??[]:[];p.length>0&&(s=(d==null?void 0:d.map((m,u)=>Array.isArray(p[u])?p[u].map((A,h)=>at({param:m,value:p[u][h]})):typeof p[u]<"u"&&p[u]!==null?at({param:m,value:p[u]}):null))??[])}return[i,...s]}function at({param:t,value:a}){if(t.type==="string"||t.type==="bytes")return ot(ct(a));if(t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/))throw new de(t.type);return Ft([t],[a])}function me(t,a){if(!S(t,{strict:!1}))throw new Q({address:t});if(!S(a,{strict:!1}))throw new Q({address:a});return t.toLowerCase()===a.toLowerCase()}const nt="/docs/contract/decodeEventLog";function ye(t){const{abi:a,data:e,strict:r,topics:o}=t,n=r??!0,[i,...s]=o;if(!i)throw new _t({docsPath:nt});const c=a.length===1?a[0]:a.find(l=>l.type==="event"&&i===B(it(l)));if(!(c&&"name"in c)||c.type!=="event")throw new dt(i,{docsPath:nt});const{name:d,inputs:p}=c,m=p==null?void 0:p.some(l=>!("name"in l&&l.name));let u=m?[]:{};const A=p.filter(l=>"indexed"in l&&l.indexed);for(let l=0;l<A.length;l++){const w=A[l],g=s[l];if(!g)throw new ut({abiItem:c,param:w});u[m?l:w.name||l]=le({param:w,value:g})}const h=p.filter(l=>!("indexed"in l&&l.indexed));if(h.length>0){if(e&&e!=="0x")try{const l=pt(h,e);if(l)if(m)u=[...u,...l];else for(let w=0;w<h.length;w++)u[h[w].name]=l[w]}catch(l){if(n)throw l instanceof Nt||l instanceof Vt?new R({abiItem:c,data:e,params:h,size:$t(e)}):l}else if(n)throw new R({abiItem:c,data:"0x",params:h,size:0})}return{eventName:d,args:Object.values(u).length>0?u:void 0}}function le({param:t,value:a}){return t.type==="string"||t.type==="bytes"||t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/)?a:(pt([t],a)||[])[0]}function fe(t){const{abi:a,args:e,logs:r,strict:o=!0}=t,n=(()=>{if(t.eventName)return Array.isArray(t.eventName)?t.eventName:[t.eventName]})();return r.map(i=>{var s;try{const c=a.find(p=>p.type==="event"&&i.topics[0]===B(p));if(!c)return null;const d=ye({...i,abi:[c],strict:o});return n&&!n.includes(d.eventName)||!ge({args:d.args,inputs:c.inputs,matchArgs:e})?null:{...d,...i}}catch(c){let d,p;if(c instanceof dt)return null;if(c instanceof R||c instanceof ut){if(o)return null;d=c.abiItem.name,p=(s=c.abiItem.inputs)==null?void 0:s.some(m=>!("name"in m&&m.name))}return{...i,args:p?[]:{},eventName:d}}}).filter(Boolean)}function ge(t){const{args:a,inputs:e,matchArgs:r}=t;if(!r)return!0;if(!a)return!1;function o(n,i,s){try{return n.type==="address"?me(i,s):n.type==="string"||n.type==="bytes"?ot(ct(i))===s:i===s}catch{return!1}}return Array.isArray(a)&&Array.isArray(r)?r.every((n,i)=>{if(n==null)return!0;const s=e[i];return s?(Array.isArray(n)?n:[n]).some(d=>o(s,d,a[i])):!1}):typeof a=="object"&&!Array.isArray(a)&&typeof r=="object"&&!Array.isArray(r)?Object.entries(r).every(([n,i])=>{if(i==null)return!0;const s=e.find(d=>d.name===n);return s?(Array.isArray(i)?i:[i]).some(d=>o(s,d,a[n])):!1}):!1}const he="0xf15d424e",Ae=[{type:"address",name:"signer"}],we=[{type:"tuple",name:"permissions",components:[{type:"address",name:"signer"},{type:"address[]",name:"approvedTargets"},{type:"uint256",name:"nativeTokenLimitPerTransaction"},{type:"uint128",name:"startTimestamp"},{type:"uint128",name:"endTimestamp"}]}];async function Ge(t){return D({contract:t.contract,method:[he,Ae,we],params:[t.signer]})}const ve="0x5892e236",Te=[{type:"tuple",name:"req",components:[{type:"address",name:"signer"},{type:"uint8",name:"isAdmin"},{type:"address[]",name:"approvedTargets"},{type:"uint256",name:"nativeTokenLimitPerTransaction"},{type:"uint128",name:"permissionStartTimestamp"},{type:"uint128",name:"permissionEndTimestamp"},{type:"uint128",name:"reqValidityStartTimestamp"},{type:"uint128",name:"reqValidityEndTimestamp"},{type:"bytes32",name:"uid"}]},{type:"bytes",name:"signature"}],Pe=[];function be(t){const a=Bt(async()=>"asyncParams"in t?await t.asyncParams():t);return $({contract:t.contract,method:[ve,Te,Pe],params:async()=>{const e=await a();return[e.req,e.signature]},value:async()=>{var e;return(e=(await a()).overrides)==null?void 0:e.value},accessList:async()=>{var e;return(e=(await a()).overrides)==null?void 0:e.accessList},gas:async()=>{var e;return(e=(await a()).overrides)==null?void 0:e.gas},gasPrice:async()=>{var e;return(e=(await a()).overrides)==null?void 0:e.gasPrice},maxFeePerGas:async()=>{var e;return(e=(await a()).overrides)==null?void 0:e.maxFeePerGas},maxPriorityFeePerGas:async()=>{var e;return(e=(await a()).overrides)==null?void 0:e.maxPriorityFeePerGas},nonce:async()=>{var e;return(e=(await a()).overrides)==null?void 0:e.nonce},extraGas:async()=>{var e;return(e=(await a()).overrides)==null?void 0:e.extraGas},erc20Value:async()=>{var e;return(e=(await a()).overrides)==null?void 0:e.erc20Value}})}function st(){return new Date(Date.now()+1e3*60*60*24*365*10)}function H(t){return ie(Math.floor(t.getTime()/1e3))}const Oe=[{name:"signer",type:"address"},{name:"isAdmin",type:"uint8"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"permissionStartTimestamp",type:"uint128"},{name:"permissionEndTimestamp",type:"uint128"},{name:"reqValidityStartTimestamp",type:"uint128"},{name:"reqValidityEndTimestamp",type:"uint128"},{name:"uid",type:"bytes32"}];async function xe(t){const{account:a,contract:e,req:r}=t,o=await a.signTypedData({domain:{name:"Account",version:"1",verifyingContract:e.address,chainId:e.chain.id},primaryType:"SignerPermissionRequest",types:{SignerPermissionRequest:Oe},message:r});return{req:r,signature:o}}async function Le(t){var r;const{target:a,permissions:e}=t;return{approvedTargets:e.approvedTargets==="*"?[yt]:e.approvedTargets,nativeTokenLimitPerTransaction:mt(((r=e.nativeTokenLimitPerTransaction)==null?void 0:r.toString())||"0"),permissionStartTimestamp:H(e.permissionStartTimestamp||new Date(0)),permissionEndTimestamp:H(e.permissionEndTimestamp||st()),reqValidityStartTimestamp:0n,reqValidityEndTimestamp:H(st()),uid:await Ht(),isAdmin:0,signer:a}}function De(t){const{contract:a,sessionKeyAddress:e,account:r,permissions:o}=t;return be({contract:a,async asyncParams(){const{req:n,signature:i}=await xe({account:r,contract:a,req:await Le({target:e,permissions:o})});return{signature:i,req:n}}})}async function Ee(t){var i;const{accountContract:a,sessionKeyAddress:e,newPermissions:r}=t;if(!await lt(a))return!0;const n=await Ge({contract:a,signer:e});return!!(n.endTimestamp&&n.endTimestamp<Math.floor(new Date().getTime()/1e3)||!Se(n.approvedTargets,r.approvedTargets)||mt(((i=r.nativeTokenLimitPerTransaction)==null?void 0:i.toString())??"0")>n.nativeTokenLimitPerTransaction)}function Se(t,a){return a==="*"&&t.length===1&&t[0]===yt?!0:a!=="*"?a.map(e=>e.toLowerCase()).every(e=>t.map(r=>r.toLowerCase()).includes(e)):!1}const Ce=2n**96n-1n;function Ue(t){const{logs:a,events:e,strict:r}=t;return fe({logs:a,abi:e.map(o=>o.abiEvent),strict:r})}function Ie(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="event")}function vt(t){const{signature:a}=t;let e;return Ie(a)?e=a:e=Rt(a),{abiEvent:e,hash:rt(e),topics:pe({abi:[e],args:t.filters})}}function Fe(t={}){return vt({signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:t})}function _e(t={}){return vt({signature:"event PostOpRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:t})}function Ne(t){const{receipt:a}=t,e={...a,transactionHash:a.transactionHash,blockNumber:a.blockNumber?BigInt(a.blockNumber):null,contractAddress:a.contractAddress?a.contractAddress:null,cumulativeGasUsed:a.cumulativeGasUsed?BigInt(a.cumulativeGasUsed):null,effectiveGasPrice:a.effectiveGasPrice?BigInt(a.effectiveGasPrice):null,gasUsed:a.gasUsed?BigInt(a.gasUsed):null,logs:a.logs,to:a.to?a.to:null,transactionIndex:a.transactionIndex,status:a.status,type:a.type};return a.blobGasPrice&&(e.blobGasPrice=BigInt(a.blobGasPrice)),a.blobGasUsed&&(e.blobGasUsed=BigInt(a.blobGasUsed)),{...t,receipt:e,userOpHash:t.userOpHash,actualGasCost:BigInt(t.actualGasCost),actualGasUsed:BigInt(t.actualGasUsed),nonce:BigInt(t.nonce)}}async function Ve(t){const{factoryContract:a,predictAddressOverride:e,adminAddress:r,accountSalt:o,accountAddress:n}=t;if(e)return e(a,r);if(n)return n;if(!r)throw new Error("Account address is required to predict the smart wallet address.");return Mt(async()=>{const i=o&&j(o)?o:ft(o??"");return D({contract:a,method:"function getAddress(address, bytes) returns (address)",params:[r,i]})},{cacheKey:`${t.factoryContract.chain.id}-${t.factoryContract.address}-${t.adminAddress}-${t.accountSalt}`,cacheTime:1e3*60*60*24})}function Tt(t){const{adminAddress:a,factoryContract:e,createAccountOverride:r,accountSalt:o}=t;if(r)return r(e,a);const n=o&&j(o)?o:ft(o??"");return $({contract:e,method:"function createAccount(address, bytes) returns (address)",params:[a,n]})}function Pt(t){const{accountContract:a,transaction:e,executeOverride:r}=t;return r?r(a,e):$({contract:a,method:"function execute(address, uint256, bytes)",params:[e.to||"",e.value||0n,e.data||"0x"],gas:e.gas?e.gas+21000n:void 0})}function $e(t){const{accountContract:a,transactions:e,executeBatchOverride:r}=t;return r?r(a,e):$({contract:a,method:"function executeBatch(address[], uint256[], bytes[])",params:[e.map(o=>o.to||""),e.map(o=>o.value||0n),e.map(o=>o.data||"0x")]})}const Be="0x35567e1a",He=[{type:"address",name:"sender"},{type:"uint192",name:"key"}],Re=[{type:"uint256",name:"nonce"}];async function Me(t){return D({contract:t.contract,method:[Be,He,Re],params:[t.sender,t.key]})}const ke="0xa6193531",qe=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"uint256",name:"callGasLimit"},{type:"uint256",name:"verificationGasLimit"},{type:"uint256",name:"preVerificationGas"},{type:"uint256",name:"maxFeePerGas"},{type:"uint256",name:"maxPriorityFeePerGas"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],je=[{type:"bytes32"}];async function ze(t){return D({contract:t.contract,method:[ke,qe,je],params:[t.userOp]})}const Ke="0x22cdde4c",We=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"bytes32",name:"accountGasLimits"},{type:"uint256",name:"preVerificationGas"},{type:"bytes32",name:"gasFees"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],Ze=[{type:"bytes32"}];async function Ye(t){return D({contract:t.contract,method:[Ke,We,Ze],params:[t.userOp]})}function Xe(t){return t.factory?C([t.factory,t.factoryData||"0x"]):"0x"}function Je(t){return C([x(L(BigInt(t.verificationGasLimit)),{size:16}),x(L(BigInt(t.callGasLimit)),{size:16})])}function Qe(t){return C([x(L(BigInt(t.maxPriorityFeePerGas)),{size:16}),x(L(BigInt(t.maxFeePerGas)),{size:16})])}function ta(t){return t.paymaster?C([t.paymaster,x(L(BigInt(t.paymasterVerificationGasLimit||0)),{size:16}),x(L(BigInt(t.paymasterPostOpGasLimit||0)),{size:16}),t.paymasterData||"0x"]):"0x"}const ea=t=>({sender:t.sender,nonce:BigInt(t.nonce),initCode:Xe(t),callData:t.callData,accountGasLimits:Je(t),preVerificationGas:BigInt(t.preVerificationGas),gasFees:Qe(t),paymasterAndData:ta(t),signature:t.signature}),aa=()=>{const t=BigInt(Math.floor(Math.random()*4294967296)),a=BigInt(Math.floor(Math.random()*4294967296)),e=BigInt(Math.floor(Math.random()*4294967296)),r=BigInt(Math.floor(Math.random()*4294967296)),o=BigInt(Math.floor(Math.random()*4294967296)),n=BigInt(Math.floor(Math.random()*4294967296));return t<<BigInt(160)|a<<BigInt(128)|e<<BigInt(96)|r<<BigInt(64)|o<<BigInt(32)|n};function Z(t){return Object.fromEntries(Object.entries(t).map(([a,e])=>[a,e==null||j(e)?e:gt(e)]))}async function N(t){var h;const{userOp:a,paymasterOverride:e,client:r,chain:o,entrypointAddress:n}=t;if(e)return e(a);const i={"Content-Type":"application/json"},s=n??b,c=z(o),d={jsonrpc:"2.0",id:1,method:"pm_sponsorUserOperation",params:[Z(a),s]},m=await ht(r)(c,{method:"POST",headers:i,body:I(d)}),u=await m.json();if(!m.ok){const l=u.error||m.statusText,w=u.code||"UNKNOWN";throw new Error(`Paymaster error: ${l}
Status: ${m.status}
Code: ${w}`)}if(u.result)return typeof u.result=="string"?{paymasterAndData:u.result}:(u.result.policyId&&u.result.reason&&console.warn(`Paymaster policy rejected this transaction with reason: ${u.result.reason} (policyId: ${u.result.policyId})`),{paymasterAndData:u.result.paymasterAndData,verificationGasLimit:u.result.verificationGasLimit?v(u.result.verificationGasLimit):void 0,preVerificationGas:u.result.preVerificationGas?v(u.result.preVerificationGas):void 0,callGasLimit:u.result.callGasLimit?v(u.result.callGasLimit):void 0,paymaster:u.result.paymaster,paymasterData:u.result.paymasterData,paymasterVerificationGasLimit:u.result.paymasterVerificationGasLimit?v(u.result.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:u.result.paymasterPostOpGasLimit?v(u.result.paymasterPostOpGasLimit):void 0});const A=((h=u.error)==null?void 0:h.message)||u.error||m.statusText||"unknown error";throw new Error(`Paymaster error from ${c}: ${A}`)}const Y=new Set,X=t=>`${t.chain.id}:${t.address}`,bt=t=>{Y.add(X(t))},Ot=t=>{Y.delete(X(t))},xt=t=>Y.has(X(t));async function na(t){const a=t.timeoutMs||12e4,e=t.intervalMs||1e3,r=Date.now()+a;for(;Date.now()<r;){const o=await la(t);if(o)return o;await new Promise(n=>setTimeout(n,e))}throw new Error(`Timeout waiting for userOp to be mined on chain ${t.chain.id} with UserOp hash: ${t.userOpHash}`)}async function sa(t){var G;const{transaction:a,accountContract:e,factoryContract:r,adminAddress:o,overrides:n,sponsorGas:i,waitForDeployment:s=!0,isDeployedOverride:c}=t,d=a.chain,p=a.client,m={client:p,chain:d,bundlerUrl:n==null?void 0:n.bundlerUrl,entrypointAddress:n==null?void 0:n.entrypointAddress},u=K(((G=t.overrides)==null?void 0:G.entrypointAddress)||b),[A,h,l,w,g]=await Promise.all([typeof c=="boolean"?c:lt(e).then(T=>T||xt(e)),W(a),F(a.gas),ra({executeTx:a,bundlerOptions:m,chain:d,client:p}),pa({accountContract:e,chain:d,client:p,entrypointAddress:n==null?void 0:n.entrypointAddress,getNonceOverride:n==null?void 0:n.getAccountNonce})]),{maxFeePerGas:y,maxPriorityFeePerGas:f}=w;return u==="v0.7"?ia({bundlerOptions:m,factoryContract:r,accountContract:e,adminAddress:o,sponsorGas:i,overrides:n,isDeployed:A,nonce:g,callData:h,callGasLimit:l,maxFeePerGas:y,maxPriorityFeePerGas:f,waitForDeployment:s}):oa({bundlerOptions:m,factoryContract:r,accountContract:e,adminAddress:o,sponsorGas:i,overrides:n,isDeployed:A,nonce:g,callData:h,callGasLimit:l,maxFeePerGas:y,maxPriorityFeePerGas:f,waitForDeployment:s})}async function ra(t){const{executeTx:a,bundlerOptions:e,chain:r,client:o}=t;let{maxFeePerGas:n,maxPriorityFeePerGas:i}=a;const s=(e==null?void 0:e.bundlerUrl)??z(r);if(qt(s)){const c=await ya({options:e});n=c.maxFeePerGas,i=c.maxPriorityFeePerGas}else{const[c,d]=await Promise.all([F(n),F(i)]);if(c&&d)n=c,i=d;else{const p=await jt(o,r);i=d??p.maxPriorityFeePerGas??0n,n=c??p.maxFeePerGas??0n}}return{maxFeePerGas:n,maxPriorityFeePerGas:i}}async function ia(t){const{bundlerOptions:a,isDeployed:e,factoryContract:r,accountContract:o,adminAddress:n,sponsorGas:i,overrides:s,nonce:c,callData:d,callGasLimit:p,maxFeePerGas:m,maxPriorityFeePerGas:u,waitForDeployment:A}=t,{chain:h,client:l}=a;let w,g;e?(g="0x",A&&await Lt(o)):(w=r.address,g=await W(Tt({factoryContract:r,adminAddress:n,accountSalt:s==null?void 0:s.accountSalt,createAccountOverride:s==null?void 0:s.createAccount})),A&&bt(o));const y={sender:o.address,nonce:c,callData:d,maxFeePerGas:m,maxPriorityFeePerGas:u,callGasLimit:p??0n,verificationGasLimit:0n,preVerificationGas:0n,factory:w,factoryData:g,paymaster:void 0,paymasterData:"0x",paymasterVerificationGasLimit:0n,paymasterPostOpGasLimit:0n,signature:At};if(i){const f=await N({userOp:y,chain:h,client:l,entrypointAddress:s==null?void 0:s.entrypointAddress,paymasterOverride:s==null?void 0:s.paymaster});if(f.paymaster&&f.paymasterData&&(y.paymaster=f.paymaster,y.paymasterData=f.paymasterData),f.callGasLimit&&f.verificationGasLimit&&f.preVerificationGas&&f.paymasterPostOpGasLimit&&f.paymasterVerificationGasLimit)y.callGasLimit=f.callGasLimit,y.verificationGasLimit=f.verificationGasLimit,y.preVerificationGas=f.preVerificationGas,y.paymasterPostOpGasLimit=f.paymasterPostOpGasLimit,y.paymasterVerificationGasLimit=f.paymasterVerificationGasLimit;else{const G=s!=null&&s.tokenPaymaster?{[s.tokenPaymaster.tokenAddress]:{stateDiff:{[zt(Kt([{type:"address"},{type:"uint256"}],[o.address,s.tokenPaymaster.balanceStorageSlot]))]:gt(Wt,{size:32})}}}:void 0,T=await V({userOp:y,options:a},G);y.callGasLimit=T.callGasLimit,y.verificationGasLimit=T.verificationGasLimit,y.preVerificationGas=T.preVerificationGas,y.paymasterPostOpGasLimit=s!=null&&s.tokenPaymaster?500000n:T.paymasterPostOpGasLimit||0n,y.paymasterVerificationGasLimit=T.paymasterVerificationGasLimit||0n;const P=await N({userOp:y,chain:h,client:l,entrypointAddress:s==null?void 0:s.entrypointAddress,paymasterOverride:s==null?void 0:s.paymaster});P.paymaster&&P.paymasterData&&(y.paymaster=P.paymaster,y.paymasterData=P.paymasterData)}}else{const f=await V({userOp:y,options:a});y.callGasLimit=f.callGasLimit,y.verificationGasLimit=f.verificationGasLimit,y.preVerificationGas=f.preVerificationGas,y.paymasterPostOpGasLimit=f.paymasterPostOpGasLimit||0n,y.paymasterVerificationGasLimit=f.paymasterVerificationGasLimit||0n}return{...y,signature:"0x"}}async function oa(t){const{bundlerOptions:a,isDeployed:e,factoryContract:r,accountContract:o,adminAddress:n,sponsorGas:i,overrides:s,nonce:c,callData:d,callGasLimit:p,maxFeePerGas:m,maxPriorityFeePerGas:u,waitForDeployment:A}=t,{chain:h,client:l}=a;let w;e?(w="0x",A&&await Lt(o)):(w=await ua({factoryContract:r,adminAddress:n,accountSalt:s==null?void 0:s.accountSalt,createAccountOverride:s==null?void 0:s.createAccount}),A&&bt(o));const g={sender:o.address,nonce:c,initCode:w,callData:d,maxFeePerGas:m,maxPriorityFeePerGas:u,callGasLimit:p??0n,verificationGasLimit:0n,preVerificationGas:0n,paymasterAndData:"0x",signature:At};if(i){const y=await N({userOp:g,chain:h,client:l,entrypointAddress:s==null?void 0:s.entrypointAddress,paymasterOverride:s==null?void 0:s.paymaster}),f="paymasterAndData"in y?y.paymasterAndData:"0x";if(f&&f!=="0x"&&(g.paymasterAndData=f),y.callGasLimit&&y.verificationGasLimit&&y.preVerificationGas)g.callGasLimit=y.callGasLimit,g.verificationGasLimit=y.verificationGasLimit,g.preVerificationGas=y.preVerificationGas;else{const G=await V({userOp:g,options:a});if(g.callGasLimit=G.callGasLimit,g.verificationGasLimit=G.verificationGasLimit,g.preVerificationGas=G.preVerificationGas,f&&f!=="0x"){const T=await N({userOp:g,chain:h,client:l,entrypointAddress:s==null?void 0:s.entrypointAddress,paymasterOverride:s==null?void 0:s.paymaster}),P="paymasterAndData"in T?T.paymasterAndData:"0x";P&&P!=="0x"&&(g.paymasterAndData=P)}}}else{const y=await V({userOp:g,options:a});g.callGasLimit=y.callGasLimit,g.verificationGasLimit=y.verificationGasLimit,g.preVerificationGas=y.preVerificationGas}return{...g,signature:"0x"}}async function ca(t){const{userOp:a,chain:e,entrypointAddress:r,adminAccount:o}=t,n=await da({client:t.client,userOp:a,chain:e,entrypointAddress:r});if(o.signMessage){const i=await o.signMessage({message:{raw:kt(n)},originalMessage:I(a),chainId:e.id});return{...a,signature:i}}throw new Error("signMessage not implemented in signingAccount")}async function da(t){const{userOp:a,chain:e,entrypointAddress:r}=t,o=K(r||b);let n;if(o==="v0.7"){const i=ea(a);n=await Ye({contract:O({address:r||wt,chain:e,client:t.client}),userOp:i})}else n=await ze({contract:O({address:r||b,chain:e,client:t.client}),userOp:a});return n}async function ua(t){const{factoryContract:a,adminAddress:e,accountSalt:r,createAccountOverride:o}=t,n=Tt({factoryContract:a,adminAddress:e,accountSalt:r,createAccountOverride:o});return C([a.address,await W(n)])}async function pa(t){const{accountContract:a,chain:e,client:r,entrypointAddress:o,getNonceOverride:n}=t;return n?n(a):await Me({contract:O({address:o||b,chain:e,client:r}),key:aa(),sender:a.address})}async function Lt(t){const a=Date.now();for(;xt(t);){if(Date.now()-a>6e4)throw Ot(t),new Error("Account deployment is taking too long (over 1 minute). Please try again.");await new Promise(e=>setTimeout(e,500))}}async function ma(t){return E({...t,operation:"eth_sendUserOperation",params:[Z(t.userOp),t.options.entrypointAddress??b]})}async function V(t,a){const e=await E({...t,operation:"eth_estimateUserOperationGas",params:[Z(t.userOp),t.options.entrypointAddress??b,a??{}]});return{preVerificationGas:v(e.preVerificationGas),verificationGas:e.verificationGas!==void 0?v(e.verificationGas):void 0,verificationGasLimit:v(e.verificationGasLimit),callGasLimit:v(e.callGasLimit)+Yt,paymasterVerificationGasLimit:e.paymasterVerificationGasLimit!==void 0?v(e.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:e.paymasterPostOpGasLimit!==void 0?v(e.paymasterPostOpGasLimit):void 0}}async function ya(t){const a=await E({...t,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxPriorityFeePerGas:v(a.maxPriorityFeePerGas),maxFeePerGas:v(a.maxFeePerGas)}}async function la(t){var e,r;const a=await fa(t);if(a){if(a.success===!1){const n=(r=(e=Ue({events:[Fe(),_e()],logs:a.logs})[0])==null?void 0:e.args)==null?void 0:r.revertReason;if(!n)throw new Error(`UserOp failed at txHash: ${a.receipt.transactionHash}`);const i=Zt({data:n});throw new Error(`UserOp failed with reason: '${i.args.join(",")}' at txHash: ${a.receipt.transactionHash}`)}return a.receipt}}async function fa(t){const a=await E({options:t,operation:"eth_getUserOperationReceipt",params:[t.userOpHash]});if(a)return Ne(a)}async function ga(t){const a=await E({options:t.options,operation:"zk_paymasterData",params:[t.transaction]});return{paymaster:a.paymaster,paymasterInput:a.paymasterInput}}async function ha(t){return{transactionHash:(await E({options:t.options,operation:"zk_broadcastTransaction",params:[{...t.transaction,signedTransaction:t.signedTransaction}]})).transactionHash}}async function E(t){const{options:a,operation:e,params:r}=t,o=a.bundlerUrl??z(a.chain),i=await ht(a.client)(o,{method:"POST",headers:{"Content-Type":"application/json"},body:I({jsonrpc:"2.0",id:1,method:e,params:r})}),s=await i.json();if(!i.ok||s.error){let c=s.error||i.statusText;typeof c=="object"&&(c=I(c));const d=s.code||"UNKNOWN";throw new Error(`${e} error: ${c}
Status: ${i.status}
Code: ${d}`)}return s.result}const Dt=new WeakMap,k=new WeakMap;async function Aa(t,a){var A,h,l,w,g,y,f;const{personalAccount:e,client:r,chain:o}=t;if(!e)throw new Error("No personal account provided for smart account connection");const n=a,i=o??n.chain,s="gasless"in n?n.gasless:n.sponsorGas;if(await Xt(i))return[Ta({creationOptions:a,connectionOptions:t,chain:i,sponsorGas:s}),i];if(n.factoryAddress&&!((A=n.overrides)!=null&&A.entrypointAddress)){const G=await Et(n.factoryAddress,r,i);G&&(n.overrides={...n.overrides,entrypointAddress:G})}(h=n.overrides)!=null&&h.tokenPaymaster&&!((l=n.overrides)!=null&&l.entrypointAddress)&&(n.overrides={...n.overrides,entrypointAddress:wt});const c=n.factoryAddress??Jt((w=n.overrides)==null?void 0:w.entrypointAddress),d=O({client:r,address:c,chain:i}),p=await Ve({factoryContract:d,adminAddress:e.address,predictAddressOverride:(g=n.overrides)==null?void 0:g.predictAddress,accountSalt:(y=n.overrides)==null?void 0:y.accountSalt,accountAddress:(f=n.overrides)==null?void 0:f.accountAddress}).then(G=>G).catch(G=>{throw new Error(`Failed to get account address with factory contract ${d.address} on chain ID ${i.id}: ${(G==null?void 0:G.message)||"unknown error"}`,{cause:G})}),m=O({client:r,address:p,chain:i}),u=await Ga({...n,chain:i,sponsorGas:s,personalAccount:e,accountContract:m,factoryContract:d,client:r});if(Dt.set(e,u),k.set(u,e),n.sessionKey&&await Ee({accountContract:m,sessionKeyAddress:n.sessionKey.address,newPermissions:n.sessionKey.permissions})){const G=De({account:e,contract:m,permissions:n.sessionKey.permissions,sessionKeyAddress:n.sessionKey.address});await Qt({account:u,transaction:G})}return[u,i]}async function wa(t){const a=k.get(t);a&&(Dt.delete(a),k.delete(t))}async function Ga(t){var o,n;const a=(o=t.overrides)==null?void 0:o.tokenPaymaster;if(a&&K(((n=t.overrides)==null?void 0:n.entrypointAddress)||b)!=="v0.7")throw new Error("Token paymaster is only supported for entrypoint version v0.7");let e=t.accountContract;const r={address:te(e.address),async sendTransaction(i){var m,u,A;let s;if(a){await va({accountContract:e,erc20Paymaster:a,options:t});const h=async()=>({paymaster:a.paymasterAddress,paymasterData:"0x"});s=((m=t.overrides)==null?void 0:m.paymaster)||h}else s=(u=t.overrides)==null?void 0:u.paymaster;i.chainId!==e.chain.id&&(e=O({address:r.address,chain:U(i.chainId),client:t.client}));const c=Pt({accountContract:e,transaction:i,executeOverride:(A=t.overrides)==null?void 0:A.execute}),d=U(i.chainId),p=await q({executeTx:c,options:{...t,chain:d,accountContract:e,overrides:{...t.overrides,paymaster:s}}});return _({client:t.client,chainId:d.id,transactionHash:p.transactionHash,walletAddress:t.accountContract.address,walletType:"smart",contractAddress:i.to??void 0}),p},async sendBatchTransaction(i){var m,u;const s=$e({accountContract:e,transactions:i,executeBatchOverride:(m=t.overrides)==null?void 0:m.executeBatch});if(i.length===0)throw new Error("No transactions to send");const c=i[0];if(!c)throw new Error("No transactions to send");const d=U(c.chainId),p=await q({executeTx:s,options:{...t,chain:d,accountContract:e}});return _({client:t.client,chainId:d.id,transactionHash:p.transactionHash,walletAddress:t.accountContract.address,walletType:"smart",contractAddress:((u=i[0])==null?void 0:u.to)??void 0}),p},async signMessage({message:i}){var c;if((c=t.overrides)!=null&&c.signMessage)return t.overrides.signMessage({adminAccount:t.personalAccount,factoryContract:t.factoryContract,accountContract:e,message:i});const{smartAccountSignMessage:s}=await tt(async()=>{const{smartAccountSignMessage:d}=await import("./signing-CfKKXaPb.js");return{smartAccountSignMessage:d}},__vite__mapDeps([0,1,2,3,4,5,6]));return s({accountContract:e,factoryContract:t.factoryContract,options:t,message:i})},async signTypedData(i){var c;if((c=t.overrides)!=null&&c.signTypedData)return t.overrides.signTypedData({adminAccount:t.personalAccount,factoryContract:t.factoryContract,accountContract:e,typedData:i});const{smartAccountSignTypedData:s}=await tt(async()=>{const{smartAccountSignTypedData:d}=await import("./signing-CfKKXaPb.js");return{smartAccountSignTypedData:d}},__vite__mapDeps([0,1,2,3,4,5,6]));return s({accountContract:e,factoryContract:t.factoryContract,options:t,typedData:i})},async onTransactionRequested(i){var s,c;return(c=(s=t.personalAccount).onTransactionRequested)==null?void 0:c.call(s,i)}};return r}async function va(t){var p;const{accountContract:a,erc20Paymaster:e,options:r}=t,o=e.tokenAddress,n=O({address:o,chain:a.chain,client:a.client});if(await ae({contract:n,owner:a.address,spender:e.paymasterAddress})>0n)return;const s=ne({contract:n,spender:e.paymasterAddress,amountWei:Ce-1n}),c=await se({transaction:s,from:a.address}),d=Pt({accountContract:a,transaction:c,executeOverride:(p=r.overrides)==null?void 0:p.execute});await q({executeTx:d,options:{...r,overrides:{...r.overrides,tokenPaymaster:void 0}}})}function Ta(t){const{creationOptions:a,connectionOptions:e,chain:r}=t,o={address:e.personalAccount.address,async sendTransaction(n){var p,m,u,A;const i={data:n.data,to:n.to??void 0,value:n.value??0n,chain:U(n.chainId),client:e.client,eip712:n.eip712};let s=await oe({account:o,transaction:i});if(t.sponsorGas&&!s.paymaster){const h=await ga({options:{client:e.client,chain:r,bundlerUrl:(p=a.overrides)==null?void 0:p.bundlerUrl,entrypointAddress:(m=a.overrides)==null?void 0:m.entrypointAddress},transaction:s});s={...s,...h}}const c=await ce({account:o,chainId:r.id,eip712Transaction:s}),d=await ha({options:{client:e.client,chain:r,bundlerUrl:(u=a.overrides)==null?void 0:u.bundlerUrl,entrypointAddress:(A=a.overrides)==null?void 0:A.entrypointAddress},transaction:s,signedTransaction:c});return _({client:e.client,chainId:r.id,transactionHash:d.transactionHash,walletAddress:o.address,walletType:"smart",contractAddress:n.to??void 0}),{transactionHash:d.transactionHash,client:e.client,chain:r}},async signMessage({message:n}){return e.personalAccount.signMessage({message:n})},async signTypedData(n){const i=ee(n);return e.personalAccount.signTypedData(i)},async onTransactionRequested(n){var i,s;return(s=(i=e.personalAccount).onTransactionRequested)==null?void 0:s.call(i,n)}};return o}async function q(t){var r,o,n;const{executeTx:a,options:e}=t;try{const i=await sa({transaction:a,factoryContract:e.factoryContract,accountContract:e.accountContract,adminAddress:e.personalAccount.address,sponsorGas:e.sponsorGas,overrides:e.overrides}),s=await ca({client:e.client,chain:e.chain,adminAccount:e.personalAccount,entrypointAddress:(r=e.overrides)==null?void 0:r.entrypointAddress,userOp:i}),c={chain:e.chain,client:e.client,bundlerUrl:(o=e.overrides)==null?void 0:o.bundlerUrl,entrypointAddress:(n=e.overrides)==null?void 0:n.entrypointAddress},d=await ma({options:c,userOp:s}),p=await na({...c,userOpHash:d});return _({client:e.client,chainId:e.chain.id,transactionHash:p.transactionHash,walletAddress:e.accountContract.address,walletType:"smart",contractAddress:await F(a.to??void 0)}),{client:e.client,chain:e.chain,transactionHash:p.transactionHash}}finally{Ot(e.accountContract)}}async function Et(t,a,e){const r=O({address:t,client:a,chain:e});try{return await D({contract:r,method:"function entrypoint() public view returns (address)"})}catch{return}}const Oa=Object.freeze(Object.defineProperty({__proto__:null,connectSmartAccount:Aa,disconnectSmartAccount:wa,getEntrypointFromFactory:Et,isSmartWallet:re},Symbol.toStringTag,{value:"Module"}));export{Oa as i,Tt as p};
