import{aE as Te,aN as ve,aO as se,aP as ct,g as dt,aQ as Bt,s as lt,aR as Y,aS as Re,aT as Ee,aU as Ot,aV as t,aW as ye,aX as c,aY as te,aZ as C,a_ as ut,a$ as D,b0 as Ft,b1 as B,b2 as We,b3 as f,b4 as Be,b5 as N,b6 as $,b7 as we,b8 as Pt,b9 as q,ba as ie,bb as Se,bc as P,au as ee,aM as Ce,bd as b,aq as xe,ap as zt,be as De,bf as tt,F as Lt,bg as je,bh as Mt,bi as Oe,bj as ht,bk as mt,bl as xt,bm as Ae,bn as Fe,bo as ne,bp as be,bq as re,br as ft,bs as Pe,bt as yt,bu as kt,bv as qt,bw as Nt,bx as _t,by as $t,bz as gt,bA as V,bB as Ut,bC as Ht,bD as wt,bE as Vt,bF as nt,bG as ke,d as st,bH as jt,bI as Kt,bJ as Gt,bK as ze,h as K,aI as Qt,bL as Yt,bM as Zt,bN as Jt,bO as bt,bP as Ct,bQ as pe,bR as Xt,bS as ge,bT as en,aF as Le,aG as Ie,bU as tn,bV as nn,bW as sn,bX as an,bY as Tt,bZ as St,b_ as on,b$ as at,c0 as rn,c1 as At,c2 as pt,c3 as cn,c4 as dn,c5 as ln,c6 as un,c7 as hn,c8 as mn,c9 as xn,ca as ot,cb as fn,cc as yn,cd as kn,ad as fe,ce as gn,cf as wn,cg as jn,ch as bn,ci as Cn,cj as Tn,ck as Sn,cl as An,cm as pn,cn as vn}from"./index-CC8cb4f7.js";import{decimals as Wn}from"./decimals-CaxlE2dJ.js";import{getCurrencyMetadata as vt}from"./getCurrencyMetadata-DrI0y3T9.js";import"./decimals-DkkWEGM9.js";async function it(e){const n=await Te(e);return ve(n)}function Dn(e,n){return se({...n,queryKey:["buyWithCryptoQuote",e],refetchInterval:2e4,queryFn:()=>{if(!e)throw new Error("Swap params are required");return ct(e)},enabled:!!e,retry:!1})}async function In(e){try{const a=await dt(e.client)(Bt(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:lt({toAddress:e.toAddress,fromCurrencySymbol:e.fromCurrencySymbol,toChainId:e.toChainId.toString(),toTokenAddress:e.toTokenAddress,fromAmount:e.fromAmount,toAmount:e.toAmount,maxSlippageBPS:e.maxSlippageBPS,isTestMode:e.isTestMode,purchaseData:e.purchaseData,fromAddress:e.fromAddress,toGasAmountWei:e.toGasAmountWei,preferredProvider:e.preferredProvider,multiHopSupported:!0})});if(!a.ok){const s=await a.json();throw s&&"error"in s?s:new Error(`HTTP error! status: ${a.status}`)}return(await a.json()).result}catch(n){throw console.error("Error getting buy with fiat quote",n),n}}function Rn(e,n){return se({...n,queryKey:["useBuyWithFiatQuote",e],queryFn:async()=>{if(!e)throw new Error("No params provided");return In(e)},enabled:!!e,retry:!1})}function En(e){var y,S,A,j,p,w;const{payUiOptions:n,supportedDestinations:a,client:s,onContinue:r,payerAccount:u}=e,d=Y(),i=Re(),o=n.metadata,l=n.paymentInfo,{data:h}=Ee(l.chain),{data:x}=Ot({client:s,address:l.sellerAddress}),k=se({queryKey:["amount",l],queryFn:async()=>{let W=18;l.token&&!P(l.token)&&(W=await Wn({contract:ee({address:l.token.address,chain:l.chain,client:s})}));let g;return"amountWei"in l?g=Ce(l.amountWei,W):g=l.amount,g}}).data;if(!h||k===void 0)return t.jsx(ye,{});const T=l.token?{...l.token,icon:((y=l.token)==null?void 0:y.icon)||((A=(S=a.find(W=>W.chain.id===l.chain.id))==null?void 0:S.tokens.find(W=>{var g;return W.address.toLowerCase()===((g=l.token)==null?void 0:g.address.toLowerCase())}))==null?void 0:A.icon)}:{address:N,name:h.nativeCurrency.name,symbol:h.nativeCurrency.symbol,icon:(j=h.icon)==null?void 0:j.url};return t.jsxs(c,{p:"lg",children:[t.jsx(te,{title:(o==null?void 0:o.name)||"Payment Details"}),t.jsx(C,{y:"lg"}),t.jsxs(c,{children:[o!=null&&o.image?t.jsx(ut,{client:s,src:o==null?void 0:o.image,style:{width:"100%",borderRadius:D.md,backgroundColor:d.colors.tertiaryBg}}):i?t.jsxs(c,{flex:"row",center:"both",style:{padding:D.md,marginBottom:D.md,borderRadius:D.md,backgroundColor:d.colors.tertiaryBg},children:[t.jsx(Ft,{size:B.xl,id:i.id,client:s}),t.jsx("div",{style:{flexGrow:1,borderBottom:"6px dotted",borderColor:d.colors.secondaryIconColor,marginLeft:D.md,marginRight:D.md}}),t.jsx(We,{client:s,size:B.xl,chainIconUrl:(p=h.icon)==null?void 0:p.url})]}):null,t.jsx(C,{y:"md"}),t.jsxs(c,{flex:"row",children:[t.jsx(c,{flex:"column",expand:!0,children:t.jsx(f,{size:"md",color:"primaryText",weight:700,children:"Price"})}),t.jsx(c,{expand:!0,children:t.jsxs(c,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:[t.jsx(Be,{chain:l.chain,client:e.client,size:"sm",token:T}),t.jsxs(f,{color:"primaryText",size:"md",weight:700,children:[String($(Number(k),6))," ",T.symbol]})]})})]}),t.jsx(C,{y:"md"}),t.jsx(we,{}),t.jsx(C,{y:"md"}),t.jsxs(c,{flex:"row",children:[t.jsx(c,{flex:"column",expand:!0,children:t.jsx(f,{size:"xs",color:"secondaryText",children:"Network"})}),t.jsx(c,{expand:!0,children:t.jsxs(c,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:[t.jsx(We,{chainIconUrl:(w=h.icon)==null?void 0:w.url,size:"xs",client:e.client}),t.jsx(f,{size:"xs",color:"secondaryText",style:{textAlign:"right"},children:h.name})]})})]}),t.jsx(C,{y:"sm"}),t.jsxs(c,{flex:"row",children:[t.jsx(c,{flex:"column",expand:!0,children:t.jsx(f,{size:"xs",color:"secondaryText",children:"Seller"})}),t.jsx(c,{expand:!0,children:t.jsx(c,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:t.jsx(f,{size:"xs",color:"secondaryText",style:{textAlign:"right"},children:x||Pt(l.sellerAddress)})})})]})]}),t.jsx(C,{y:"xl"}),u?t.jsx(q,{variant:"accent",fullWidth:!0,onClick:()=>{ie({event:"choose_payment_method_direct_payment_mode",client:s,walletAddress:u.address,walletType:i==null?void 0:i.id}),r(k,l.chain,T)},children:"Choose Payment Method"}):t.jsx("div",{children:t.jsx(Se,{...e.connectOptions,client:s,theme:d,connectButton:{style:{width:"100%"}}})})]})}function Bn(e){const{transaction:n,account:a,supportedDestinations:s}=e,[r,u]=b.useState();return b.useEffect(()=>{Promise.all([xe(n.value),xe(n.erc20Value),xe(n.to),zt(n)]).then(([d,i,o,l])=>{var h;u({value:d==null?void 0:d.toString(),erc20Value:(h=i==null?void 0:i.amountWei)==null?void 0:h.toString(),erc20Currency:i==null?void 0:i.tokenAddress,to:o,data:l})})},[n]),se({queryKey:["transaction-cost",n.chain.id,a==null?void 0:a.address,r],queryFn:async()=>{var m,k,T;if(!a)throw new Error("No payer account found");const d=await xe(n.erc20Value);if(d){const[y,S,A]=await Promise.all([De({address:a.address,chain:n.chain,client:n.client,tokenAddress:d.tokenAddress}),vt({contract:ee({address:d.tokenAddress,chain:n.chain,client:n.client})}),tt(n,a==null?void 0:a.address)]),j=d.amountWei,p=y;return{token:{address:d.tokenAddress,name:S.name,symbol:S.symbol,icon:(k=(m=s.find(W=>W.chain.id===n.chain.id))==null?void 0:m.tokens.find(W=>W.address.toLowerCase()===d.tokenAddress.toLowerCase()))==null?void 0:k.icon},decimals:S.decimals,walletBalance:p,gasCostWei:A,transactionValueWei:j}}const[i,o,l]=await Promise.all([De({address:a.address,chain:n.chain,client:n.client}),Lt(n.chain),tt(n,a==null?void 0:a.address)]),h=i,x=await xe(n.value)||0n;return{token:{address:N,name:o.nativeCurrency.name,symbol:o.nativeCurrency.symbol,icon:(T=o.icon)==null?void 0:T.url},decimals:18,walletBalance:h,gasCostWei:l,transactionValueWei:x}},enabled:!!n&&!!r,refetchInterval:()=>{if(!n.erc20Value)return 3e4}})}function On(e){var W;const{payUiOptions:n,client:a,payerAccount:s,supportedDestinations:r,onContinue:u}=e,{data:d,error:i,isLoading:o,refetch:l}=Ee(n.transaction.chain),h=n.metadata,{data:x,error:m,isLoading:k,refetch:T}=Bn({transaction:n.transaction,account:s,supportedDestinations:r}),y=Y(),S=Re(),A=je(),j=Mt(S),p=Oe({address:A==null?void 0:A.address,chain:n.transaction.chain,tokenAddress:P((x==null?void 0:x.token)||ht)||x==null?void 0:x.token.address,client:e.client},{enabled:!!x});if(k||o)return t.jsx(ye,{});if(!A)return t.jsx(c,{style:{minHeight:"350px"},fullHeight:!0,flex:"row",center:"both",children:t.jsxs(c,{animate:"fadein",children:[t.jsx(C,{y:"xxl"}),t.jsx(c,{flex:"row",center:"x",children:t.jsx(mt,{size:B["3xl"]})}),t.jsx(C,{y:"lg"}),t.jsx(f,{center:!0,color:"primaryText",size:"md",children:"Please connect a wallet to continue"}),t.jsx(C,{y:"xl"}),t.jsx(c,{flex:"row",center:"x",style:{width:"100%"},children:t.jsx(Se,{client:a,theme:y,...e.connectOptions})})]})});if(m||i)return t.jsx(c,{style:{minHeight:"350px"},fullHeight:!0,flex:"row",center:"both",children:t.jsx(xt,{title:(m==null?void 0:m.message)||(i==null?void 0:i.message)||"Something went wrong",onTryAgain:m?T:l})});if(!x||!d)return t.jsx(ye,{});const w=p.data&&p.data.value<x.transactionValueWei;return t.jsxs(c,{p:"lg",children:[t.jsx(te,{title:(h==null?void 0:h.name)||"Transaction"}),t.jsx(C,{y:"lg"}),t.jsxs(c,{children:[h!=null&&h.image?t.jsx(ut,{client:a,src:h==null?void 0:h.image,style:{width:"100%",borderRadius:D.md,border:`1px solid ${y.colors.borderColor}`,backgroundColor:y.colors.tertiaryBg}}):A?t.jsxs(c,{flex:"column",gap:"sm",children:[w&&t.jsx(f,{size:"sm",color:"danger",style:{textAlign:"center"},children:"Insufficient funds"}),t.jsxs(c,{flex:"row",style:{justifyContent:"space-between",padding:D.sm,marginBottom:D.sm,borderRadius:D.md,backgroundColor:y.colors.tertiaryBg,border:`1px solid ${y.colors.borderColor}`},children:[t.jsx(Ae,{address:A==null?void 0:A.address,iconSize:"md",client:a}),p.data?t.jsxs(c,{flex:"row",gap:"3xs",center:"y",children:[t.jsx(f,{size:"xs",color:"secondaryText",weight:500,children:Fe(p.data,!1)}),t.jsx(ne,{token:x.token,chain:n.transaction.chain,size:"xs",color:"secondaryText"})]}):t.jsx(be,{width:"70px",height:re.xs})]})]}):null,t.jsx(C,{y:"md"}),t.jsxs(c,{flex:"row",children:[t.jsx(c,{flex:"column",expand:!0,children:t.jsx(f,{size:"md",color:"primaryText",weight:700,children:"Price"})}),t.jsx(c,{expand:!0,children:t.jsxs(c,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:[t.jsx(Be,{chain:n.transaction.chain,client:e.client,size:"sm",token:x.token}),t.jsxs(f,{color:"primaryText",size:"md",weight:700,children:[String($(Number(Ce(x.transactionValueWei,x.decimals)),6))," ",x.token.symbol]})]})})]}),t.jsx(C,{y:"md"}),t.jsx(we,{}),t.jsx(C,{y:"md"}),t.jsxs(c,{flex:"row",children:[t.jsx(c,{flex:"column",expand:!0,children:t.jsx(f,{size:"xs",color:"secondaryText",children:"Gas Fees"})}),t.jsx(c,{expand:!0,children:t.jsx(c,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:t.jsx(f,{color:j?"success":"primaryText",size:"xs",children:j?"Sponsored":`${String($(Number(Ce(x.gasCostWei,d.nativeCurrency.decimals)),6))} ${d.nativeCurrency.symbol}`})})})]}),t.jsx(C,{y:"sm"}),t.jsxs(c,{flex:"row",children:[t.jsx(c,{flex:"column",expand:!0,children:t.jsx(f,{size:"xs",color:"secondaryText",children:"Network"})}),t.jsx(c,{expand:!0,children:t.jsxs(c,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:[t.jsx(We,{chainIconUrl:(W=d.icon)==null?void 0:W.url,size:"xs",client:e.client}),t.jsx(f,{size:"xs",color:"secondaryText",style:{textAlign:"right"},children:d.name})]})})]})]}),t.jsx(C,{y:"xl"}),s?t.jsx(q,{variant:"accent",fullWidth:!0,onClick:()=>{var z;let g=w?x.transactionValueWei-(((z=p.data)==null?void 0:z.value)||0n):x.transactionValueWei;x.token.address===N&&!j&&(g+=x.gasCostWei),ie({event:"choose_payment_method_transaction_mode",client:a,walletAddress:s.address,walletType:S==null?void 0:S.id}),u(Ce(g,x.decimals),n.transaction.chain,x.token)},children:"Choose Payment Method"}):t.jsx("div",{children:t.jsx(Se,{...e.connectOptions,client:a,theme:y,connectButton:{style:{width:"100%"}}})})]})}function Fn(e){return t.jsxs(c,{children:[t.jsx(c,{p:"lg",children:t.jsx(te,{title:"Pay with",onBack:e.onBack})}),t.jsx(we,{}),t.jsx(C,{y:"lg"}),t.jsx(c,{flex:"column",gap:"xs",px:"lg",children:ft.map(n=>t.jsxs(Pn,{fullWidth:!0,variant:"secondary",onClick:()=>e.onSelect(n),gap:"sm",children:[yt(n,"lg"),t.jsxs(c,{flex:"column",gap:"xxs",children:[t.jsx(f,{color:"primaryText",children:n.shorthand}),t.jsx(f,{size:"sm",children:n.name})]})]},n.shorthand))}),t.jsx(C,{y:"lg"})]})}const Pn=Pe(q)(()=>{const e=Y();return{background:e.colors.tertiaryBg,justifyContent:"flex-start",gap:D.sm,padding:D.sm,"&:hover":{background:e.colors.secondaryButtonBg,transform:"scale(1.01)"},transition:"background 200ms ease, transform 150ms ease"}}),Me="Unable to get price quote";function Wt(e){return typeof e.error=="object"&&e.error.code&&e.error.code==="MINIMUM_PURCHASE_AMOUNT"?{code:"MINIMUM_PURCHASE_AMOUNT",message:"Purchase amount is too low"}:{code:"UNABLE_TO_GET_PRICE_QUOTE",message:Me}}const Dt=b.forwardRef(function(n,a){return t.jsx(zn,{ref:a,children:t.jsx(Nt,{children:t.jsxs(c,{p:"lg",children:[t.jsx(_t,{children:t.jsx($t,{type:"button","aria-label":"Close",onClick:n.close,children:t.jsx(gt,{width:B.md,height:B.md,style:{color:"inherit"}})})}),n.children]})})})}),zn=kt(e=>{const n=Y();return{zIndex:1e4,borderTopLeftRadius:V.xl,borderTopRightRadius:V.xl,background:n.colors.modalBg,position:"absolute",bottom:0,left:0,right:0,animation:`${Ln} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.1)`,borderTop:`1px solid ${n.colors.borderColor}`}}),Ln=Ut`
  from {
    opacity: 0;
    transform: translateY(100px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
`,It=kt(e=>({backgroundColor:Y().colors.modalOverlayBg,zIndex:9999,position:"absolute",inset:0,animation:`${qt} 400ms cubic-bezier(0.16, 1, 0.3, 1)`}));function Rt(){const[e,n]=b.useState(!1),a=b.useRef(null),s=b.useRef(null),r=b.useCallback(()=>new Promise(d=>{var i;if(a.current){const o={easing:"cubic-bezier(0.175, 0.885, 0.32, 1.1)",fill:"forwards",duration:300},l=a.current.animate([{transform:"translateY(100%)",opacity:0}],o);(i=s.current)==null||i.animate([{opacity:0}],o),l.onfinish=()=>d()}else d()}),[]),u=b.useCallback(async d=>{d?n(!0):(await r(),n(!1))},[r]);return b.useLayoutEffect(()=>{if(!e)return;const d=i=>{a.current&&i.target instanceof Node&&!a.current.contains(i.target)&&u(!1)};return requestAnimationFrame(()=>{document.addEventListener("click",d)}),()=>{document.removeEventListener("click",d)}},[e,u]),{drawerRef:a,drawerOverlayRef:s,setIsOpen:u,isOpen:e}}function Mn(e){if(e>3600){const n=Math.floor(e/3600),a=Math.floor(e%3600/60);return`${n} Hours ${a} Minutes`}return e>60?`${Math.ceil(e/60)} Minutes`:`${e}s`}function Et(e){const{estimatedSeconds:n,quoteIsLoading:a}=e;return t.jsxs(c,{bg:"tertiaryBg",flex:"row",borderColor:"borderColor",style:{borderRadius:V.md,borderTopLeftRadius:0,borderTopRightRadius:0,justifyContent:"space-between",alignItems:"center",borderWidth:"1px",borderStyle:"solid"},children:[t.jsxs(c,{flex:"row",center:"y",gap:"xxs",color:"accentText",p:"sm",children:[t.jsx(Ht,{width:B.sm,height:B.sm}),a?t.jsx(be,{height:re.xs,width:"50px",color:"borderColor"}):t.jsx(f,{size:"xs",color:"secondaryText",children:n!==void 0?`~${Mn(n)}`:"--"})]}),t.jsxs(q,{variant:"ghost",onClick:e.onViewFees,gap:"xs",children:[t.jsx(c,{color:"accentText",flex:"row",center:"both",children:t.jsx(qn,{size:B.sm})}),t.jsx(f,{size:"xs",color:"secondaryText",children:"View Fees"})]})]})}const qn=e=>t.jsxs("svg",{width:e.size,height:e.size,viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[t.jsx("path",{d:"M9.5 1.5H2.5C1.94772 1.5 1.5 1.94772 1.5 2.5V9.5C1.5 10.0523 1.94772 10.5 2.5 10.5H9.5C10.0523 10.5 10.5 10.0523 10.5 9.5V2.5C10.5 1.94772 10.0523 1.5 9.5 1.5Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),t.jsx("path",{d:"M4.5 7.5L7.5 4.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})]});function Nn(e){return t.jsxs(c,{bg:"tertiaryBg",borderColor:"borderColor",flex:"row",style:{borderRadius:V.md,borderBottomRightRadius:0,borderBottomLeftRadius:0,borderWidth:"1px",borderStyle:"solid",borderBottom:"none",flexWrap:"nowrap",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(_n,{variant:"ghost",onClick:e.onSelectCurrency,style:{minHeight:"64px",justifyContent:"flex-start",minWidth:"50%"},gap:"sm",children:[yt(e.currency,"md"),t.jsxs(c,{flex:"row",center:"y",gap:"xxs",color:"secondaryText",children:[t.jsx(f,{color:"primaryText",children:e.currency.shorthand}),t.jsx(wt,{width:B.sm,height:B.sm})]})]}),t.jsx("div",{style:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:D.xxs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",justifyContent:"center",paddingRight:D.sm},children:e.isLoading?t.jsx(be,{width:"100px",height:re.lg}):t.jsx(f,{size:"lg",color:e.value?"primaryText":"secondaryText",children:e.value?`${e.currency.symbol}${$(Number(e.value),6)}`:"--"})})]})}const _n=Pe(q)(()=>({"&[disabled]:hover":{borderColor:"transparent"}}));function $n(e){return t.jsx(c,{flex:"column",gap:"xs",style:{alignItems:"flex-start"},children:e.quote.processingFees.map(n=>{const a=$(Number(n.amount),6);return t.jsxs(c,{flex:"row",gap:"xxs",children:[t.jsxs(f,{color:"primaryText",size:"sm",children:[a===0?"~":"",a," ",n.token.symbol]}),t.jsxs(f,{color:"secondaryText",size:"sm",children:["($",(n.amountUSDCents/100).toFixed(2),")"]})]},`${n.token.chainId}_${n.token.tokenAddress}_${a}`)})})}function Un(e){return t.jsxs(c,{flex:"column",gap:"xs",children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx(f,{inline:!0,color:"secondaryText",children:"Amount"}),t.jsxs(f,{color:"primaryText",inline:!0,children:[$(Number(e.quote.fromCurrency.amount),2)," ",e.quote.fromCurrency.currencySymbol]})]}),e.quote.processingFees.map((n,a)=>{const s=$(Number(n.amount),6);return t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx(f,{inline:!0,color:"secondaryText",children:n.feeType==="NETWORK"?"Network Fee":"Processing Fee"}),t.jsxs(f,{color:"primaryText",inline:!0,children:[s===0?"~":""," ",s," ",n.currencySymbol]})]},a)}),t.jsx(C,{y:"xxs"}),t.jsx(we,{}),t.jsx(C,{y:"xxs"}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx(f,{inline:!0,color:"secondaryText",children:"Total"}),t.jsxs(f,{color:"primaryText",inline:!0,children:[$(Number(e.quote.fromCurrencyWithFees.amount),6)," ",e.quote.fromCurrencyWithFees.currencySymbol]})]})]})}const Hn=["COINBASE","STRIPE","TRANSAK","KADO"];function Vn(e){return t.jsx(c,{expand:!0,flex:"column",gap:"sm",style:{alignItems:"flex-start"},children:Hn.map(n=>t.jsx(c,{flex:"row",expand:!0,style:{justifyContent:"space-between"},children:t.jsx(q,{fullWidth:!0,onClick:()=>e.onSelect(n),variant:"link",children:t.jsx(Vt,{color:e.preferredProvider===n?"primaryText":"secondaryText",size:"sm",hoverColor:"primaryText",children:n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()})})},n))})}function Kn(e){var O,L,H,U,E,_,ae,oe,Z,J;const{toToken:n,tokenAmount:a,payer:s,client:r,setScreen:u,toChain:d,showCurrencySelector:i,selectedCurrency:o}=e,h=((L=(O=e.payOptions)==null?void 0:O.paymentInfo)==null?void 0:L.sellerAddress)||e.payer.account.address,{drawerRef:x,drawerOverlayRef:m,isOpen:k,setIsOpen:T}=Rt(),[y,S]=b.useState("fees"),A=e.payOptions.buyWithFiat,[j,p]=b.useState(A!==!1?(A==null?void 0:A.preferredProvider)||(localStorage.getItem(nt)??void 0):void 0),w=Rn(A!==!1&&a?{fromCurrencySymbol:o.shorthand,toChainId:d.id,toAddress:h,toTokenAddress:P(n)?N:n.address,toAmount:a,client:r,isTestMode:A==null?void 0:A.testMode,purchaseData:e.payOptions.purchaseData,fromAddress:s.account.address,preferredProvider:j}:void 0);function W(){w.data&&u({id:"fiat-flow",quote:w.data})}function g(){w.data&&(S("fees"),T(!0))}function z(){S("providers"),T(!0)}const v=!w.data,R=!w.isLoading&&w.error?Wt(w.error):void 0;return t.jsxs(c,{flex:"column",gap:"lg",animate:"fadein",children:[k&&t.jsxs(t.Fragment,{children:[t.jsx(It,{ref:m}),t.jsxs(Dt,{ref:x,close:()=>T(!1),children:[y==="fees"&&w.data&&t.jsxs("div",{children:[t.jsx(f,{size:"lg",color:"primaryText",children:"Fees"}),t.jsx(C,{y:"lg"}),t.jsx(Un,{quote:w.data})]}),y==="providers"&&t.jsxs("div",{children:[t.jsx(f,{size:"lg",color:"primaryText",children:"Providers"}),t.jsx(C,{y:"lg"}),t.jsx(Vn,{preferredProvider:j||((H=w.data)==null?void 0:H.provider),onSelect:G=>{p(G),localStorage.setItem(nt,G),T(!1)}})]})]})]}),t.jsxs(c,{flex:"column",gap:"sm",children:[t.jsx(f,{size:"sm",children:"Pay with credit card"}),t.jsxs("div",{children:[t.jsx(Nn,{isLoading:w.isLoading,value:(U=w.data)==null?void 0:U.fromCurrencyWithFees.amount,client:r,currency:o,onSelectCurrency:i}),t.jsxs(c,{bg:"tertiaryBg",flex:"row",borderColor:"borderColor",style:{paddingLeft:D.md,justifyContent:"space-between",alignItems:"center",borderWidth:"1px",borderStyle:"solid",borderBottom:"none"},children:[t.jsx(f,{size:"xs",color:"secondaryText",children:"Provider"}),t.jsx(q,{variant:"ghost",onClick:z,children:t.jsxs(c,{flex:"row",center:"y",gap:"xxs",color:"secondaryText",children:[t.jsx(f,{size:"xs",children:j?`${j.charAt(0).toUpperCase()+j.slice(1).toLowerCase()}`:(E=w.data)!=null&&E.provider?`${((_=w.data)==null?void 0:_.provider.charAt(0).toUpperCase())+((ae=w.data)==null?void 0:ae.provider.slice(1).toLowerCase())}`:""}),t.jsx(wt,{width:B.sm,height:B.sm})]})})]}),t.jsx(Et,{quoteIsLoading:w.isLoading,estimatedSeconds:(oe=w.data)==null?void 0:oe.estimatedDurationSeconds,onViewFees:g})]}),R&&t.jsx("div",{children:(Z=R.data)!=null&&Z.minimumAmountEth?t.jsxs(f,{color:"danger",size:"sm",center:!0,multiline:!0,children:["Minimum amount is"," ",$(Number(R.data.minimumAmountEth),6)," ",t.jsx(ne,{token:n,chain:d,size:"sm",inline:!0,color:"danger"})]}):t.jsx(f,{color:"danger",size:"sm",center:!0,multiline:!0,children:R.message||Me})})]}),(J=R==null?void 0:R.data)!=null&&J.minimumAmountEth?t.jsx(q,{variant:"accent",fullWidth:!0,onClick:()=>{var G;e.setTokenAmount($(Number((G=R.data)==null?void 0:G.minimumAmountEth),6).toString()),e.setHasEditedAmount(!0)},children:"Set Minimum"}):t.jsx(q,{variant:v?"outline":"accent","data-disabled":v,disabled:v,fullWidth:!0,onClick:W,gap:"xs",children:w.isLoading?t.jsxs(t.Fragment,{children:["Getting price quote",t.jsx(ke,{size:"sm",color:"accentText"})]}):"Continue"})]})}function Gn(e){const n=e.toToken.chainId===e.onRampToken.token.chainId,a=st(e.toToken.tokenAddress)===st(e.onRampToken.token.tokenAddress);return!(n&&a)}function Qn(e){return Gn(e)?e.routingToken?[{action:"buy",token:e.onRampToken.token,amount:e.onRampToken.amount},{action:"swap",token:e.routingToken.token,amount:e.routingToken.amount},{action:"bridge",token:e.toToken,amount:e.estimatedToAmountMin}]:[{action:"buy",token:e.onRampToken.token,amount:e.onRampToken.amount},{action:"swap",token:e.toToken,amount:e.estimatedToAmountMin}]:[{action:"buy",token:e.toToken,amount:e.estimatedToAmountMin}]}function Yn(e,n){const r=(window.innerHeight-750)/2,u=(window.innerWidth-500)/2;return window.open(`${e}&theme=${n}`,"thirdweb Pay",`width=500, height=750, top=${r}, left=${u}`)}function Zn(e){var u;const n=jt(),a=ss({wallet:e.payer.wallet,connectedWallets:n}),s=Xn({quote:e.quote,client:e.client,onSuccess:e.onSuccess,onDone:e.onDone,payer:e.payer,theme:e.theme,isAutoMode:a}),r=(u=s.steps[0])==null?void 0:u.step.token.chainId;return t.jsxs(c,{p:"lg",children:[t.jsx(te,{title:e.title,onBack:e.onBack}),t.jsx(C,{y:"xl"}),t.jsx(c,{flex:"column",gap:"xs",center:"y",style:{paddingLeft:D.md},children:t.jsx(Ae,{client:e.client,address:e.receiverAddress,iconSize:"md",textSize:"sm",label:"Recipient wallet"})}),t.jsx(C,{y:"md"}),t.jsx(c,{flex:"column",children:s.steps.map(({step:d,status:i},o)=>t.jsxs(c,{flex:"column",children:[t.jsx(Kt,{state:i,index:o,style:{flex:"1"},children:t.jsx(Jn,{step:d,client:e.client,payer:e.payer,index:o})}),o<s.steps.length-1&&t.jsx(Gt,{})]},d.action))}),t.jsx(C,{y:"md"}),t.jsx(f,{size:"xs",color:"secondaryText",center:!0,style:{padding:`0 ${D.xl}`},children:"Keep this window open until all transactions are complete."}),t.jsx(C,{y:"lg"}),t.jsx(c,{flex:"column",gap:"md",children:!s.isDone&&r&&r!==e.payer.chain.id?t.jsx(ze,{fullWidth:!0,variant:"accent",switchChain:async()=>{await e.payer.wallet.switchChain(K(r))}}):t.jsxs(q,{variant:"accent",gap:"sm",fullWidth:!0,onClick:s.handleContinue,disabled:s.isLoading,children:[s.isLoading?"Processing":s.isDone?e.transactionMode?"Continue Transaction":"Done":s.isFailed?"Retry":"Continue",s.isLoading&&t.jsx(ke,{size:"sm",color:"primaryText"})]})})]})}function Jn(e){const{step:n,client:a}=e,s=bt(K(n.token.chainId));return t.jsx(c,{flex:"column",gap:"xs",py:"3xs",children:t.jsxs(c,{flex:"row",center:"y",gap:"sm",style:{display:"flex",justifyContent:"space-between",flexWrap:"nowrap"},children:[t.jsx(Ct,{chain:K(n.token.chainId),client:a,size:"md",token:{address:n.token.tokenAddress}}),t.jsxs(c,{flex:"column",gap:"3xs",center:"y",style:{flex:"1"},children:[t.jsx(f,{size:"sm",color:"primaryText",children:n.action.charAt(0).toUpperCase()+n.action.slice(1)}),t.jsxs(c,{flex:"row",gap:"xs",center:"y",style:{display:"flex",justifyContent:"space-between",flexWrap:"nowrap"},children:[t.jsxs(c,{flex:"row",gap:"xxs",center:"y",style:{flex:"1 1 60%",minWidth:0,maxWidth:"60%",overflow:"hidden",flexWrap:"nowrap"},children:[t.jsx(f,{size:"sm",color:"primaryText",children:$(Number(n.amount),5)}),t.jsx(ne,{token:{address:n.token.tokenAddress,name:n.token.name||"",symbol:n.token.symbol||""},chain:K(n.token.chainId),size:"sm",color:"secondaryText"})]}),t.jsx(c,{flex:"row",gap:"xs",center:"y",style:{flex:"1 1 40%",maxWidth:"40%",minWidth:0,justifyContent:"flex-end",flexWrap:"nowrap"},children:t.jsx(f,{size:"xs",style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.name})})]})]})]})})}function Xn(e){const n=Qn(e.quote),[a,s]=b.useState(0),[r,u]=b.useState(),[d,i]=b.useState(null),{uiStatus:o}=es({intentId:e.quote.intentId,client:e.client,onSuccess:j=>{n.length===1?e.onSuccess(j):s(p=>p+1)},openedWindow:d}),l=n[a-1],h=n[a],x=ns({client:e.client,payer:e.payer}),{uiStatus:m}=ts({client:e.client,transactionHash:r==null?void 0:r.hash,chainId:r==null?void 0:r.chainId,onSuccess:()=>{a===n.length-1?sn({intentId:e.quote.intentId,client:e.client}).then(e.onSuccess):(u(void 0),x.reset(),s(j=>j+1))}}),k=n.map((j,p)=>{let w="unknown";return p===0?w=o:p<a?w="completed":p===a&&(x.isPending?w="pending":x.error?w="failed":r?w=m:w="actionRequired"),{index:p,step:j,status:w}}),T=k.some(j=>j.status==="pending"),y=k.every(j=>j.status==="completed"),S=k.some(j=>j.status==="failed"),A=b.useCallback(async()=>{if(y){e.onDone();return}if(a===0){const j=Yn(e.quote.onRampLink,e.theme);ie({event:"open_onramp_popup",client:e.client,walletAddress:e.payer.account.address,walletType:e.payer.wallet.id}),i(j),Jt({type:"fiat",intentId:e.quote.intentId})}else if(l&&h&&!r)try{const j=await x.mutateAsync({fromToken:l.token,toToken:h.token,amount:h.amount});u({hash:j.transactionHash,chainId:j.chainId})}catch(j){console.error("Failed to execute swap:",j)}else S&&(u(void 0),x.reset())},[y,a,r,e.quote,e.onDone,x,e.theme,S,x.reset,e.client,e.payer.account.address,e.payer.wallet.id,h,l]);return b.useEffect(()=>{e.isAutoMode&&!T&&!y&&!S&&a>0&&a<n.length&&!r&&A()},[e.isAutoMode,a,r,n.length,A,y,S,T]),{steps:k,handleContinue:A,isLoading:T,isDone:y,isFailed:S}}function es(e){var d;const n=pe(),a=Xt({intentId:e.intentId,client:e.client,queryOptions:{enabled:!!e.openedWindow}});let s="actionRequired";switch((d=a.data)==null?void 0:d.status){case"ON_RAMP_TRANSFER_COMPLETED":case"CRYPTO_SWAP_COMPLETED":case"CRYPTO_SWAP_REQUIRED":s="completed";break;case"CRYPTO_SWAP_FALLBACK":s="partialSuccess";break;case"ON_RAMP_TRANSFER_FAILED":case"PAYMENT_FAILED":s="failed";break;case"PENDING_PAYMENT":case"ON_RAMP_TRANSFER_IN_PROGRESS":s="pending";break;default:s="actionRequired";break}const r=b.useRef(!1);b.useEffect(()=>{r.current||!e.onSuccess||a.data&&(s==="completed"||s==="partialSuccess")&&(r.current=!0,e.onSuccess(a.data))},[e.onSuccess,a.data,s]),b.useEffect(()=>{if(e.openedWindow&&(s==="completed"||s==="partialSuccess"))try{e.openedWindow&&!e.openedWindow.closed&&e.openedWindow.close()}catch(i){console.warn("Failed to close payment window:",i)}},[e.openedWindow,s]);const u=b.useRef(!1);return b.useEffect(()=>{!u.current&&s==="completed"&&(u.current=!0,ge(n))},[s,n]),{uiStatus:s}}function ts(e){var d;const n=nn(e.transactionHash&&e.chainId?{client:e.client,transactionHash:e.transactionHash,chainId:e.chainId}:void 0);let a="unknown";switch((d=n.data)==null?void 0:d.status){case"COMPLETED":a="completed";break;case"FAILED":a="failed";break;case"PENDING":case"NOT_FOUND":a="pending";break;case"NONE":a="unknown";break;default:a="unknown";break}const s=b.useRef(!1);b.useEffect(()=>{var i;s.current||!e.onSuccess||((i=n.data)==null?void 0:i.status)==="COMPLETED"&&(s.current=!0,e.onSuccess(n.data))},[e.onSuccess,n]);const r=pe(),u=b.useRef(!1);return b.useEffect(()=>{a==="completed"&&!u.current&&(u.current=!0,ge(r))},[r,a]),{uiStatus:a}}function ns(e){const n=pe();return en({mutationFn:async a=>{var T;const{fromToken:s,toToken:r,amount:u}=a,d=e.payer.wallet;((T=d.getChain())==null?void 0:T.id)!==s.chainId&&await d.switchChain(K(s.chainId));const i=d.getAccount();if(!i)throw new Error("Payer wallet has no account");const o=await ct({fromChainId:s.chainId,fromTokenAddress:s.tokenAddress,toAmount:u,toChainId:r.chainId,toTokenAddress:r.tokenAddress,fromAddress:i.address,toAddress:i.address,client:e.client}),l=i.sendBatchTransaction,h=ee({client:e.client,address:o.swapDetails.fromToken.tokenAddress,chain:K(o.swapDetails.fromToken.chainId)}),x=o.approvalData&&await Le({contract:h,owner:i.address,spender:o.approvalData.spenderAddress})<BigInt(o.approvalData.amountWei);if(x&&o.approvalData&&!l){ie({event:"prompt_swap_approval",client:e.client,walletAddress:i.address,walletType:e.payer.wallet.id,fromToken:o.swapDetails.fromToken.tokenAddress,fromAmount:o.swapDetails.fromAmountWei,toToken:o.swapDetails.toToken.tokenAddress,toAmount:o.swapDetails.toAmountWei,chainId:o.swapDetails.fromToken.chainId,dstChainId:o.swapDetails.toToken.chainId});const y=Ie({contract:h,spender:o.approvalData.spenderAddress,amountWei:BigInt(o.approvalData.amountWei)}),S=await Te({account:i,transaction:y});await ve({...S,maxBlocksWaitTime:50}),ie({event:"swap_approval_success",client:e.client,walletAddress:i.address,walletType:e.payer.wallet.id,fromToken:o.swapDetails.fromToken.tokenAddress,fromAmount:o.swapDetails.fromAmountWei,toToken:o.swapDetails.toToken.tokenAddress,toAmount:o.swapDetails.toAmountWei,chainId:o.swapDetails.fromToken.chainId,dstChainId:o.swapDetails.toToken.chainId})}ie({event:"prompt_swap_execution",client:e.client,walletAddress:i.address,walletType:e.payer.wallet.id,fromToken:o.swapDetails.fromToken.tokenAddress,fromAmount:o.swapDetails.fromAmountWei,toToken:o.swapDetails.toToken.tokenAddress,toAmount:o.swapDetails.toAmountWei,chainId:o.swapDetails.fromToken.chainId,dstChainId:o.swapDetails.toToken.chainId});const m=o.transactionRequest;let k;if(l&&o.approvalData&&x){const y=Ie({contract:h,spender:o.approvalData.spenderAddress,amountWei:BigInt(o.approvalData.amountWei)});k=await tn({account:i,transactions:[y,m]})}else k=await Te({account:i,transaction:m});return await ve({...k,maxBlocksWaitTime:50}),ie({event:"swap_execution_success",client:e.client,walletAddress:i.address,walletType:e.payer.wallet.id,fromToken:o.swapDetails.fromToken.tokenAddress,fromAmount:o.swapDetails.fromAmountWei,toToken:o.swapDetails.toToken.tokenAddress,toAmount:o.swapDetails.toAmountWei,chainId:o.swapDetails.fromToken.chainId,dstChainId:o.swapDetails.toToken.chainId}),{transactionHash:k.transactionHash,chainId:k.chain.id}},onSuccess:()=>{ge(n)}})}function ss(e){const n=s=>Yt(s)||Zt(s),a=Qt(e.wallet)&&e.connectedWallets.some(s=>{var r,u,d,i,o,l;return n(s)&&((u=(r=s.getAccount())==null?void 0:r.address)==null?void 0:u.toLowerCase())===((l=(o=(i=(d=e.wallet).getAdminAccount)==null?void 0:i.call(d))==null?void 0:o.address)==null?void 0:l.toLowerCase())});return n(e.wallet)||a}function as(e){const{payOptions:n,supportedDestinations:a,toChain:s,toToken:r}=e;function u(){const h=a.find(k=>k.chain.id===s.id);if(!h)return{fiat:!1,swap:!1};const x=P(r)?N:r.address,m=h.tokens.find(k=>k.address.toLowerCase()===x.toLowerCase());return m?{fiat:m.buyWithFiatEnabled,swap:m.buyWithCryptoEnabled}:{fiat:!0,swap:!0}}const{fiat:d,swap:i}=u(),o=n.buyWithFiat!==!1&&d,l=n.buyWithCrypto!==!1&&i;return{buyWithFiatEnabled:o,buyWithCryptoEnabled:l}}const os=an({id:137,name:"Polygon",nativeCurrency:{name:"POL",symbol:"POL",decimals:18},blockExplorers:[{name:"PolygonScan",url:"https://polygonscan.com",apiUrl:"https://api.polygonscan.com/api"}]});function is(e){var k,T,y,S;const{payOptions:n,supportedDestinations:a}=e,s=n==null?void 0:n.prefillBuy,r=Tt(),u=(s==null?void 0:s.amount)||"",[d,i]=b.useState(u),o=St(d,300);b.useEffect(()=>{s!=null&&s.amount&&i(s.amount),s!=null&&s.chain&&h(s.chain),s!=null&&s.token&&m(s.token)},[s==null?void 0:s.amount,s==null?void 0:s.chain,s==null?void 0:s.token]);const[l,h]=b.useState((s==null?void 0:s.chain)||n.mode==="transaction"&&((k=n.transaction)==null?void 0:k.chain)||n.mode==="direct_payment"&&((T=n.paymentInfo)==null?void 0:T.chain)||((y=a.find(A=>A.chain.id===(r==null?void 0:r.id)))==null?void 0:y.chain)||((S=a[0])==null?void 0:S.chain)||os),[x,m]=b.useState((s==null?void 0:s.token)||n.mode==="direct_payment"&&n.paymentInfo.token||ht);return{toChain:l,setToChain:h,toToken:x,setToToken:m,tokenAmount:d,setTokenAmount:i,deferredTokenAmount:o}}function rs(e){var h,x,m,k,T,y;const{payOptions:n}=e,[a,s]=b.useState(),r=n.buyWithCrypto!==!1&&((x=(h=n.buyWithCrypto)==null?void 0:h.prefillSource)==null?void 0:x.chain)||n.mode==="transaction"&&((m=n.transaction)==null?void 0:m.chain)||n.mode==="direct_payment"&&((k=n.paymentInfo)==null?void 0:k.chain),u=a||r||void 0,[d,i]=b.useState(),o=n.buyWithCrypto!==!1&&((y=(T=n.buyWithCrypto)==null?void 0:T.prefillSource)==null?void 0:y.token)||n.mode==="direct_payment"&&n.paymentInfo.token;return{fromChain:u,setFromChain:s,fromToken:d||o||void 0,setFromToken:i}}function cs(e){var d,i;const{payOptions:n}=e,s=(n.buyWithFiat!==!1?(i=(d=n.buyWithFiat)==null?void 0:d.prefillSource)==null?void 0:i.currency:void 0)||ds(),[r,u]=b.useState(ft.find(o=>o.shorthand===s)||on);return{selectedCurrency:r,setSelectedCurrency:u}}function ds(){try{const e=Intl.DateTimeFormat().resolvedOptions().timeZone.toLowerCase();return e.includes("london")?"GBP":e.includes("europe")?"EUR":e.includes("japan")?"JPY":e.includes("canada")?"CAD":e.includes("australia")?"AUD":e.includes("new zealand")?"NZD":"USD"}catch{return"USD"}}function ls(e){return e.length>10?"26px":e.length>6?"34px":"50px"}function qe(e){var s;const n=St(e.tokenAmount,500),a=se({queryKey:["cryptoToFiat",e.chain.id,at(e.token),n],queryFn:()=>rn({client:e.client,chain:e.chain,fromTokenAddress:at(e.token),fromAmount:Number(n),to:"USD"})});return a.isLoading?t.jsx(be,{width:"50px",height:re.lg}):(s=a.data)!=null&&s.result?t.jsxs(f,{...e,children:["$",$(a.data.result,2).toFixed(2)]}):null}function us(e){const n=()=>{let a=e.value.replace(".","").length;return e.value.includes(".")&&(a+=.3),`calc(${`${Math.max(1,a)}ch`} + 6px)`};return t.jsxs(c,{children:[t.jsx("div",{onClick:a=>{var s;(s=a.currentTarget.querySelector("input"))==null||s.focus()},children:t.jsxs(c,{flex:"row",center:"both",gap:"xs",style:{flexWrap:"nowrap"},children:[t.jsx(At,{variant:"outline",pattern:"^[0-9]*[.,]?[0-9]*$",inputMode:"decimal",tabIndex:-1,placeholder:"0",type:"text","data-placeholder":e.value==="",value:e.value||"0",disabled:e.freezeAmount,onClick:a=>{e.value===""&&a.currentTarget.setSelectionRange(a.currentTarget.value.length,a.currentTarget.value.length)},onChange:a=>{let s=a.target.value;s=s.replace(",","."),s.startsWith(".")&&(s=`0${s}`);const r=Number(s);Number.isNaN(r)||(s.startsWith("0")&&!s.startsWith("0.")?e.onChange(s.slice(1)):e.onChange(s))},style:{border:"none",fontSize:ls(e.value),boxShadow:"none",borderRadius:"0",padding:"0",paddingBlock:"2px",fontWeight:600,textAlign:"right",width:n(),maxWidth:"calc(100% - 100px)"}}),t.jsx(ne,{token:e.token,chain:e.chain,size:"lg",color:"secondaryText"})]})}),t.jsx(c,{flex:"row",center:"both",style:{height:re.xl},children:t.jsx(qe,{tokenAmount:e.value,token:e.token,chain:e.chain,client:e.client,size:"md"})}),!e.hideTokenSelector&&t.jsxs(t.Fragment,{children:[t.jsx(C,{y:"md"}),t.jsx(c,{flex:"row",center:"x",children:t.jsx(pt,{token:e.token,chain:e.chain,client:e.client,onSelectToken:e.onSelectToken,freezeChainAndToken:e.freezeChainAndToken})})]})]})}function hs(e){var s;const n=Y(),a=Oe({address:e.payerAccount.address,chain:e.chain,tokenAddress:P(e.token)||(s=e.token)==null?void 0:s.address,client:e.client},{enabled:!!e.chain&&!!e.token});return t.jsxs(c,{bg:"tertiaryBg",style:{borderRadius:V.lg,border:`1px solid ${n.colors.borderColor}`,...e.swapRequired?{borderBottom:"none",borderBottomLeftRadius:0,borderBottomRightRadius:0}:{}},children:[t.jsxs(c,{flex:"row",gap:"sm",style:{justifyContent:"space-between",padding:D.sm,borderBottom:`1px solid ${n.colors.borderColor}`},children:[t.jsx(Ae,{client:e.client,address:e.payerAccount.address}),e.token&&e.chain&&a.data?t.jsxs(c,{flex:"row",gap:"3xs",center:"y",children:[t.jsx(f,{size:"xs",color:"secondaryText",weight:500,children:Fe(a.data,!1,4)}),t.jsx(ne,{token:e.token,chain:e.chain,size:"xs",color:"secondaryText"})]}):e.token&&e.chain&&a.isLoading?t.jsx(be,{width:"70px",height:re.xs}):null]}),t.jsx(pt,{token:e.token,chain:e.chain,client:e.client,isLoading:e.isLoading,value:e.value,onSelectToken:e.onSelectToken,style:{border:"none",borderRadius:0,borderBottomLeftRadius:!e.token||!e.chain||!e.swapRequired?V.lg:0,borderBottomRightRadius:!e.token||!e.chain||!e.swapRequired?V.lg:0}})]})}function ms(e){var oe,Z,J,G,ce,de,le,ue,he,me;const{setScreen:n,payer:a,client:s,toChain:r,tokenAmount:u,toToken:d,fromChain:i,fromToken:o,payOptions:l,disableTokenSelection:h}=e,m=((Z=(oe=e.payOptions)==null?void 0:oe.paymentInfo)==null?void 0:Z.sellerAddress)||e.activeAccount.address,{drawerRef:k,drawerOverlayRef:T,isOpen:y,setIsOpen:S}=Rt(),[A,j]=b.useState("fees"),p=Oe({address:a.account.address,chain:i,tokenAddress:P(o)||o==null?void 0:o.address,client:s},{enabled:!!i&&!!o}),w=P(o)?N:(J=o==null?void 0:o.address)==null?void 0:J.toLowerCase(),W=P(d)?N:d.address.toLowerCase(),g=!!u&&!!i&&!!w&&!((i==null?void 0:i.id)===r.id&&w===W),z=i&&o&&g?{fromAddress:a.account.address,toAddress:m,fromChainId:i.id,fromTokenAddress:P(o)?N:o.address,toChainId:r.id,toTokenAddress:P(d)?N:d.address,toAmount:u,client:s,purchaseData:l.purchaseData}:void 0,v=Dn(z,{staleTime:30*1e3,refetchInterval:30*1e3,gcTime:30*1e3}),R=se({queryKey:["allowance",a.account.address,(G=v.data)==null?void 0:G.approvalData],queryFn:()=>{var X;return(X=v.data)!=null&&X.approvalData?Le({contract:ee({client:e.client,address:v.data.swapDetails.fromToken.tokenAddress,chain:K(v.data.swapDetails.fromToken.chainId)}),spender:v.data.approvalData.spenderAddress,owner:e.payer.account.address}):null},enabled:!!((ce=v.data)!=null&&ce.approvalData),refetchOnMount:!0}),O=g?(de=v.data)==null?void 0:de.swapDetails.fromAmount:u,L=!!O&&!!p.data&&Number(p.data.displayValue)<Number(O),H=!i||!o||g&&!v.data||L||R.isLoading,U=((le=e.payer.wallet.getChain())==null?void 0:le.id)!==(i==null?void 0:i.id),E=!v.isLoading&&v.error?Wt(v.error):void 0;function _(){if((e.payOptions.mode==="direct_payment"||e.payOptions.mode==="fund_wallet")&&!L&&!g)n({id:"transfer-flow"});else if(e.payOptions.mode==="transaction"&&!L&&!g){a.account.address!==m?n({id:"transfer-flow"}):e.onDone();return}v.data&&n({id:"swap-flow",quote:v.data,approvalAmount:R.data??void 0})}function ae(){v.data&&(S(!0),j("fees"))}return t.jsxs(c,{flex:"column",gap:"lg",animate:"fadein",children:[y&&t.jsxs(t.Fragment,{children:[t.jsx(It,{ref:T}),t.jsx(Dt,{ref:k,close:()=>S(!1),children:A==="fees"&&v.data&&t.jsxs("div",{children:[t.jsx(f,{size:"lg",color:"primaryText",children:"Fees"}),t.jsx(C,{y:"lg"}),t.jsx($n,{quote:v.data})]})})]}),t.jsxs(c,{flex:"column",gap:"sm",children:[t.jsxs(c,{flex:"row",gap:"xxs",center:"y",children:[t.jsx(f,{size:"sm",children:"Pay with"}),o&&i?t.jsx(ne,{token:o,chain:i,size:"sm",color:"secondaryText"}):"crypto"]}),t.jsxs("div",{children:[t.jsx(hs,{value:O||"",chain:i,token:o,isLoading:v.isLoading&&!O,client:s,freezeChainAndTokenSelection:h,payerAccount:e.payer.account,swapRequired:g,onSelectToken:e.showFromTokenSelector}),g&&i&&o&&t.jsx(Et,{quoteIsLoading:v.isLoading,estimatedSeconds:(ue=v.data)==null?void 0:ue.swapDetails.estimated.durationSeconds,onViewFees:ae})]}),E&&t.jsx("div",{children:(he=E.data)!=null&&he.minimumAmountEth?t.jsxs(f,{color:"danger",size:"xs",center:!0,multiline:!0,children:["Minimum amount is"," ",$(Number(E.data.minimumAmountEth),6)," ",t.jsx(ne,{token:d,chain:r,size:"sm",inline:!0,color:"danger"})]}):t.jsx(f,{color:"danger",size:"xs",center:!0,multiline:!0,children:E.message||Me})}),!E&&L&&t.jsx("div",{children:t.jsx(f,{color:"danger",size:"xs",center:!0,multiline:!0,children:"Insufficient funds"})})]}),(me=E==null?void 0:E.data)!=null&&me.minimumAmountEth?t.jsx(q,{variant:"accent",fullWidth:!0,onClick:()=>{var X;e.setTokenAmount($(Number((X=E.data)==null?void 0:X.minimumAmountEth),6).toString()),e.setHasEditedAmount(!0)},children:"Set Minimum"}):L||E?t.jsx(q,{variant:"accent",fullWidth:!0,onClick:()=>e.showFromTokenSelector(),children:"Pay with another token"}):U&&i&&!v.isLoading&&!R.isLoading&&!L&&!v.error?t.jsx(ze,{variant:"accent",fullWidth:!0,switchChain:async()=>{await e.payer.wallet.switchChain(i)}}):t.jsx(q,{variant:H?"outline":"accent",fullWidth:!0,"data-disabled":H,disabled:H,onClick:async()=>{H||_()},gap:"xs",children:v.isLoading?t.jsxs(t.Fragment,{children:["Getting price quote",t.jsx(ke,{size:"sm",color:"accentText"})]}):"Continue"})]})}function xs(e){const n=jt(),a=je(),s=Ee(e.toChain),r=Y(),u=se({queryKey:["wallets-and-balances",e.sourceSupportedTokens,e.toChain.id,e.toToken,e.tokenAmount,e.mode,a==null?void 0:a.address,n.map(i=>{var o;return(o=i.getAccount())==null?void 0:o.address})],queryFn:async()=>{const i=new Map,o=n.flatMap(l=>{var T,y,S,A,j;const h=l.getAccount();if(!h)return[];const x={id:l.id,address:h.address};i.set(x,[]);const m=P(e.toToken)?{address:N,name:((T=s.data)==null?void 0:T.nativeCurrency.name)||"",symbol:((y=s.data)==null?void 0:y.nativeCurrency.symbol)||"",icon:(A=(S=s.data)==null?void 0:S.icon)==null?void 0:A.url}:e.toToken,k={...e.sourceSupportedTokens,[e.toChain.id]:[m,...((j=e.sourceSupportedTokens)==null?void 0:j[e.toChain.id])||[]]};return Object.entries(k).flatMap(([p,w])=>w.map(async W=>{try{const g=K(Number(p)),z=await De({address:h.address,chain:g,tokenAddress:P(W)?void 0:W.address,client:e.client});if(W.address===m.address&&g.id===e.toChain.id?e.mode==="fund_wallet"&&h.address===(a==null?void 0:a.address)?!1:Number(z.displayValue)>Number(e.tokenAmount):z.value>0n){const R=i.get(x)||[];R.push({balance:z,chain:g,token:W}),R.sort((O,L)=>O.chain.id===e.toChain.id&&O.token.address===m.address?-1:L.chain.id===e.toChain.id&&L.token.address===m.address?1:O.chain.id===e.toChain.id?-1:L.chain.id===e.toChain.id||O.chain.id>L.chain.id?1:-1)}}catch(g){console.error(`Failed to fetch balance for wallet ${l.id} on chain ${p} for token ${W.symbol}:`,g)}}))});return await Promise.all(o),i},enabled:!!e.sourceSupportedTokens&&!!s.data});if(u.isLoading||!u.data)return t.jsx(ye,{});const d=Array.from(u.data.entries()||[]).filter(([i])=>{var o;return!((o=e.hiddenWallets)!=null&&o.includes(i.id))}).filter(([,i])=>i.some(l=>l.balance.value>0));return t.jsxs(c,{animate:"fadein",style:{minHeight:"200px"},children:[d.length===0?t.jsx(c,{flex:"column",gap:"xs",py:"lg",children:t.jsxs(f,{size:"xs",color:"secondaryText",center:!0,children:["No suitable payment token found",t.jsx("br",{}),"in connected wallets"]})}):t.jsxs(c,{flex:"column",gap:"xs",children:[t.jsx(f,{size:"sm",children:"Select payment token"}),t.jsx(C,{y:"xs"})]}),t.jsx(c,{scrollY:!0,style:{maxHeight:"350px"},children:t.jsxs(c,{flex:"column",gap:"sm",children:[d.map(([i,o])=>{const l=i.address,h=n.find(x=>{var m;return((m=x.getAccount())==null?void 0:m.address)===l});return h?t.jsx(fs,{wallet:h,balances:o,client:e.client,address:l,onClick:e.onSelectToken},i.id):null}),d.length>0&&t.jsx(cn,{text:"OR"}),t.jsx(q,{variant:"secondary",fullWidth:!0,onClick:e.onConnect,bg:"tertiaryBg",style:{border:`1px solid ${r.colors.borderColor}`,padding:D.sm},children:t.jsxs(c,{flex:"row",gap:"sm",center:"y",expand:!0,color:"secondaryIconColor",children:[t.jsx(mt,{size:B.md}),t.jsx(f,{size:"sm",color:"primaryText",children:"Pay with another wallet"})]})}),e.fiatSupported&&t.jsx(q,{variant:"secondary",fullWidth:!0,onClick:e.onPayWithFiat,bg:"tertiaryBg",style:{border:`1px solid ${r.colors.borderColor}`,padding:D.sm},children:t.jsxs(c,{flex:"row",gap:"sm",center:"y",expand:!0,color:"secondaryIconColor",children:[t.jsx(dn,{width:B.md,height:B.md}),t.jsx(f,{size:"sm",color:"primaryText",children:"Pay with credit card"})]})})]})})]})}function fs(e){const n=Y(),a=e.balances,s=je(),{disconnect:r}=ln(),u=(s==null?void 0:s.address)===e.address;return t.jsxs(c,{flex:"column",style:{borderRadius:V.lg,border:`1px solid ${n.colors.borderColor}`},children:[t.jsxs(c,{flex:"row",gap:"sm",bg:"tertiaryBg",style:{justifyContent:"space-between",borderTopRightRadius:V.lg,borderTopLeftRadius:V.lg,padding:D.sm,paddingRight:D.xs,borderBottom:`1px solid ${n.colors.borderColor}`},children:[t.jsx(Ae,{...e}),!u&&t.jsx(q,{variant:"ghost",onClick:()=>r(e.wallet),style:{padding:D.xxs,color:n.colors.secondaryText},children:t.jsx(gt,{width:B.sm,height:B.sm})})]}),t.jsx(c,{flex:"column",children:e.balances.length>0?a.map((d,i)=>t.jsx(ys,{client:e.client,onClick:()=>e.onClick(e.wallet,d.token,d.chain),tokenBalance:d,wallet:e.wallet,style:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomRightRadius:i===a.length-1?V.lg:0,borderBottomLeftRadius:i===a.length-1?V.lg:0,borderBottom:i===a.length-1?"none":`1px solid ${n.colors.borderColor}`}},`${d.token.address}-${d.chain.id}`)):t.jsx(c,{style:{padding:D.sm},children:t.jsx(f,{size:"sm",color:"secondaryText",children:"Insufficient funds"})})})]})}function ys(e){const{tokenBalance:n,wallet:a,onClick:s,client:r,style:u}=e,d=bt(n.chain);return t.jsxs(ks,{onClick:()=>s(n.token,a),variant:"secondary",style:{...u,display:"flex",justifyContent:"space-between",minWidth:0},children:[t.jsxs(c,{flex:"row",center:"y",gap:"sm",style:{flex:"1 1 50%",minWidth:0,maxWidth:"50%",overflow:"hidden",flexWrap:"nowrap"},children:[t.jsx(Be,{token:n.token,chain:n.chain,size:"md",client:r}),t.jsxs(c,{flex:"column",gap:"4xs",style:{minWidth:0},children:[t.jsx(f,{size:"xs",color:"primaryText",style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n.token.symbol}),d&&t.jsx(f,{size:"xs",style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:d.name})]})]}),t.jsxs(c,{flex:"row",center:"y",gap:"4xs",color:"secondaryText",style:{flex:"1 1 50%",maxWidth:"50%",minWidth:0,justifyContent:"flex-end",flexWrap:"nowrap"},children:[t.jsxs(c,{flex:"column",color:"secondaryText",gap:"4xs",style:{alignItems:"flex-end",minWidth:0,overflow:"hidden"},children:[t.jsx(f,{size:"xs",color:"primaryText",style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:Fe(n.balance,!0,2)}),t.jsx(qe,{tokenAmount:n.balance.displayValue,token:n.token,chain:n.chain,client:r,size:"xs"})]}),t.jsx(un,{width:B.md,height:B.md,style:{flexShrink:0}})]})]})}const ks=Pe(q)(e=>{const n=Y();return{background:"transparent",justifyContent:"space-between",flexWrap:"nowrap",flexDirection:"row",padding:D.sm,paddingRight:D.xs,gap:D.sm,"&:hover":{background:n.colors.secondaryButtonBg,transform:"scale(1.01)"},transition:"background 200ms ease, transform 150ms ease",...e.style}});async function gs(e){try{const a=await dt(e.client)(hn(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:lt({fromAddress:e.fromAddress,toAddress:e.toAddress,chainId:e.chainId,tokenAddress:e.tokenAddress,amount:e.amount,purchaseData:e.purchaseData})});if(!a.ok){const u=await a.json();throw u&&"error"in u?u:new Error(`HTTP error! status: ${a.status}`)}const s=(await a.json()).result;return{transactionRequest:{chain:K(s.transactionRequest.chainId),client:e.client,data:s.transactionRequest.data,to:s.transactionRequest.to,value:BigInt(s.transactionRequest.value),extraGas:50000n},approvalData:s.approval,fromAddress:s.fromAddress,toAddress:s.toAddress,paymentToken:s.paymentToken,processingFee:s.processingFee,estimatedGasCostUSDCents:s.estimatedGasCostUSDCents,client:e.client}}catch(n){throw console.error("Error getting buy with crypto transfer",n),n}}function ws(e){var p;const{title:n,onBack:a,receiverAddress:s,client:r,payer:u,onDone:d,chain:i,token:o,tokenAmount:l,transactionMode:h,setTransactionHash:x,payOptions:m}=e,[k,T]=b.useState("transfer"),[y,S]=b.useState({id:"idle"}),A=se({queryKey:["transfer",P(o)?N:o.address,l,s,u.account.address,m==null?void 0:m.purchaseData],queryFn:async()=>await gs({client:r,fromAddress:u.account.address,toAddress:s,chainId:i.id,tokenAddress:P(o)?N:o.address,amount:l,purchaseData:m==null?void 0:m.purchaseData}),refetchInterval:30*1e3});if(A.isLoading)return t.jsxs(c,{p:"lg",children:[t.jsx(te,{title:n,onBack:a}),t.jsxs(c,{flex:"column",center:"both",style:{minHeight:"300px"},children:[t.jsx(C,{y:"xl"}),t.jsx(ke,{size:"xl",color:"secondaryText"}),t.jsx(C,{y:"xl"})]})]});const j=((p=A.data)==null?void 0:p.paymentToken.amount)||l;return t.jsxs(c,{p:"lg",children:[t.jsx(te,{title:n,onBack:a}),t.jsx(C,{y:"xl"}),h?t.jsxs(t.Fragment,{children:[t.jsx(mn,{steps:2,currentStep:k==="transfer"?1:2}),t.jsx(C,{y:"sm"}),t.jsx(f,{size:"sm",children:k==="transfer"?"Step 1 of 2 - Transfer funds":"Step 2 of 2 - Finalize transaction"}),t.jsx(C,{y:"md"})]}):t.jsxs(t.Fragment,{children:[t.jsx(f,{size:"sm",children:"Confirm payment"}),t.jsx(C,{y:"md"})]}),t.jsx(xn,{sender:u.account.address,receiver:s,client:r,fromToken:o,fromChain:i,toToken:o,toChain:i,fromAmount:h?l:j,toAmount:l}),t.jsx(C,{y:"lg"}),h&&t.jsxs(t.Fragment,{children:[t.jsx(C,{y:"sm"}),t.jsxs(c,{gap:"sm",flex:"row",style:{justifyContent:"space-between"},center:"y",color:"accentText",children:[t.jsx(ot,{isDone:k==="execute",isActive:k==="transfer",label:k==="transfer"?"Transfer":"Done"}),t.jsx(fn,{}),t.jsx(ot,{isDone:!1,label:"Finalize",isActive:k==="execute"})]}),t.jsx(C,{y:"lg"})]}),y.id==="error"&&t.jsxs(t.Fragment,{children:[t.jsx(c,{flex:"row",gap:"xs",center:"both",color:"danger",children:t.jsx(f,{color:"danger",size:"sm",style:{textAlign:"center"},children:k==="transfer"?`${y.error||"Failed to Transfer"}`:"Failed to Execute"})}),t.jsx(C,{y:"md"})]}),!h&&k==="execute"&&y.id==="done"&&t.jsxs(t.Fragment,{children:[t.jsxs(c,{flex:"row",gap:"xs",center:"both",color:"success",children:[t.jsx(yn,{width:B.sm,height:B.sm}),t.jsx(f,{color:"success",size:"sm",children:"Payment completed"})]}),t.jsx(C,{y:"md"})]}),u.chain.id!==i.id?t.jsx(ze,{fullWidth:!0,variant:"accent",switchChain:async()=>{await e.payer.wallet.switchChain(i)}}):t.jsxs(q,{variant:"accent",fullWidth:!0,disabled:y.id==="pending",onClick:async()=>{var w,W;if(k==="execute"){d();return}try{if(S({id:"pending"}),h){const g=P(o)?kn({client:r,chain:i,to:s,value:fe(l)}):gn({contract:ee({address:o.address,chain:i,client:r}),to:s,amount:l}),[z,v]=await Promise.all([it({account:e.payer.account,transaction:g}),vt({contract:ee({address:P(o)?N:o.address,chain:i,client:r})})]);(w=e.onSuccess)==null||w.call(e,js({token:o,chain:i,tokenMetadata:v,tokenAmount:h?l:j,fromAddress:u.account.address,toAddress:s,transaction:z})),T("execute"),S({id:"idle"})}else{const g=A.data;if(!g)throw new Error("Transfer data not found");if(g.approvalData&&await Le({contract:ee({client:r,address:g.approvalData.tokenAddress,chain:K(g.approvalData.chainId)}),spender:g.approvalData.spenderAddress,owner:u.account.address})<BigInt(g.approvalData.amountWei)){T("approve");const O=Ie({contract:ee({client:r,address:g.approvalData.tokenAddress,chain:K(g.approvalData.chainId)}),spender:g.approvalData.spenderAddress,amountWei:BigInt(g.approvalData.amountWei)});await it({account:e.payer.account,transaction:O})}T("transfer");const z=g.transactionRequest,v=await Te({account:e.payer.account,transaction:z});x(v.transactionHash),S({id:"idle"})}}catch(g){console.error(g),S({id:"error",error:"error"in g?(W=g.error)==null?void 0:W.message:g==null?void 0:g.message})}},gap:"xs",children:[k==="execute"&&(y.id==="done"?"Done":"Continue"),k==="transfer"&&(y.id==="pending"?"Confirming":"Confirm"),k==="approve"&&(y.id==="pending"?"Approving":"Approve"),y.id==="pending"&&t.jsx(ke,{size:"sm",color:"accentButtonText"})]})]})}function js(e){const{token:n,chain:a,tokenMetadata:s,tokenAmount:r,fromAddress:u,toAddress:d,transaction:i}=e;return{status:"COMPLETED",subStatus:"SUCCESS",swapType:"TRANSFER",quote:{createdAt:new Date().toISOString(),fromToken:{chainId:a.id,tokenAddress:P(n)?N:n.address,decimals:s.decimals,symbol:s.symbol,name:s.name,priceUSDCents:0},toToken:{chainId:a.id,tokenAddress:P(n)?N:n.address,decimals:s.decimals,symbol:s.symbol,name:s.name,priceUSDCents:0},fromAmountWei:fe(r).toString(),fromAmount:r,toAmountWei:fe(r).toString(),toAmount:r,toAmountMin:r,toAmountMinWei:fe(r).toString(),estimated:{feesUSDCents:0,gasCostUSDCents:0,slippageBPS:0,toAmountMinUSDCents:0,toAmountUSDCents:0,fromAmountUSDCents:0,durationSeconds:0}},fromAddress:u,toAddress:d,source:{transactionHash:i.transactionHash,amount:r,amountWei:fe(r).toString(),amountUSDCents:0,completedAt:new Date().toISOString(),token:{chainId:a.id,tokenAddress:P(n)?N:n.address,decimals:s.decimals,symbol:s.symbol,name:s.name,priceUSDCents:0}}}}function bs(e){const[n,a]=b.useState();return n?t.jsx(wn,{title:e.title,onBack:e.onBack,onTryAgain:e.onTryAgain,swapTxHash:n,fromChain:e.chain,client:e.client,onDone:e.onDone,transactionMode:!1,isEmbed:e.isEmbed,quote:void 0,onSuccess:e.onSuccess}):t.jsx(ws,{...e,setTransactionHash:a})}function Cs(){const e=Re(),n=je(),a=Tt(),[s,r]=b.useState();return b.useEffect(()=>{const i=s==null?void 0:s.wallet;function o(){if(!i){r(void 0);return}const l=i.getAccount(),h=i.getChain();r(l&&h?{account:l,chain:h,wallet:i}:void 0)}if(i){const l=i.subscribe("chainChanged",o),h=i.subscribe("accountChanged",o);return()=>{l(),h()}}},[s]),{payer:s||(n&&a&&e?{account:n,chain:a,wallet:e}:void 0),setPayer:r}}function Es(e){const n=e.payOptions.buyWithCrypto?e.payOptions.buyWithCrypto.testMode:void 0,a=jn(e.client,n);if(a.isError)return t.jsx(c,{style:{minHeight:"350px"},fullHeight:!0,flex:"row",center:"both",children:t.jsx(xt,{title:"Something went wrong",onTryAgain:a.refetch})});if(!a.data)return t.jsx(ye,{});const s=e.supportedTokens?Object.entries(e.supportedTokens).map(([r,u])=>({chain:K(Number.parseInt(r)),tokens:u.map(d=>({...d,buyWithCryptoEnabled:!0,buyWithFiatEnabled:!0}))})):a.data;return t.jsx(Ts,{...e,supportedDestinations:s})}function Ts(e){var Z,J,G,ce,de,le,ue,he,me,X,Ne,_e,$e,Ue,He,Ve,Ke,Ge,Qe,Ye,Ze,Je,Xe,et;const{client:n,supportedDestinations:a,connectLocale:s,payOptions:r}=e,u=je(),{payer:d,setPayer:i}=Cs(),[o,l]=b.useState({id:"main"}),{tokenAmount:h,setTokenAmount:x,toChain:m,setToChain:k,deferredTokenAmount:T,toToken:y,setToToken:S}=is({payOptions:r,supportedDestinations:a}),[A,j]=b.useState(!1),p=b.useCallback(()=>{l({id:"main"}),e.onDone()},[e.onDone]),w=bn({client:e.client,destinationChainId:m.id,destinationTokenAddress:P(y)?N:y.address}),W=b.useMemo(()=>rt(a,r,e.supportedTokens),[e.supportedTokens,a,r]),g=b.useMemo(()=>{if(!w.data)return;const I=w.data;return rt(I,r,e.supportedTokens)},[e.supportedTokens,w.data,r]),{fromChain:z,setFromChain:v,fromToken:R,setFromToken:O}=rs({payOptions:r,supportedSources:w.data||[]}),{selectedCurrency:L,setSelectedCurrency:H}=cs({payOptions:r}),U=as({payOptions:e.payOptions,supportedDestinations:e.supportedDestinations,toChain:m,toToken:y}),E=U.buyWithCryptoEnabled===!1&&U.buyWithFiatEnabled===!1,_=pe(),ae=b.useCallback(I=>{var M,F;(F=(M=e.payOptions).onPurchaseSuccess)==null||F.call(M,{type:"crypto",status:I}),ge(_)},[e.payOptions.onPurchaseSuccess,_]),oe=b.useCallback(I=>{var M,F;(F=(M=e.payOptions).onPurchaseSuccess)==null||F.call(M,{type:"fiat",status:I}),ge(_)},[e.payOptions.onPurchaseSuccess,_]);if(o.id==="connect-payer-wallet")return t.jsx(Cn,{accountAbstraction:(Z=e.connectOptions)==null?void 0:Z.accountAbstraction,appMetadata:(J=e.connectOptions)==null?void 0:J.appMetadata,chain:(G=e.connectOptions)==null?void 0:G.chain,chains:(ce=e.connectOptions)==null?void 0:ce.chains,client:e.client,connectLocale:e.connectLocale,isEmbed:e.isEmbed,onBack:()=>l(o.backScreen),onSelect:I=>{const M=I.getAccount(),F=I.getChain();I&&M&&F&&i({account:M,chain:F,wallet:I})},hiddenWallets:e.hiddenWallets,recommendedWallets:(de=e.connectOptions)==null?void 0:de.recommendedWallets,showAllWallets:((le=e.connectOptions)==null?void 0:le.showAllWallets)===void 0?!0:(ue=e.connectOptions)==null?void 0:ue.showAllWallets,walletConnect:(he=e.connectOptions)==null?void 0:he.walletConnect,wallets:(X=(me=e.connectOptions)==null?void 0:me.wallets)==null?void 0:X.filter(I=>I.id!=="inApp")});if(o.id==="swap-flow"&&d)return t.jsx(Tn,{title:e.title,transactionMode:r.mode==="transaction",isEmbed:e.isEmbed,client:n,onBack:()=>{l({id:"buy-with-crypto"})},buyWithCryptoQuote:o.quote,payer:d,isFiatFlow:!1,onDone:p,onTryAgain:()=>{l({id:"buy-with-crypto"})},onSuccess:ae,approvalAmount:o.approvalAmount});if(o.id==="fiat-flow"&&d){const M=((_e=(Ne=e.payOptions)==null?void 0:Ne.paymentInfo)==null?void 0:_e.sellerAddress)||d.account.address;return t.jsx(Zn,{title:e.title,transactionMode:r.mode==="transaction",quote:o.quote,onBack:()=>{l({id:"buy-with-fiat"})},client:n,testMode:e.payOptions.buyWithFiat!==!1&&(($e=e.payOptions.buyWithFiat)==null?void 0:$e.testMode)===!0,theme:typeof e.theme=="string"?e.theme:e.theme.type,onDone:p,isEmbed:e.isEmbed,payer:d,receiverAddress:M,onSuccess:oe})}if(o.id==="transfer-flow"&&d&&u){const I=()=>l({id:"buy-with-crypto"}),F=((He=(Ue=e.payOptions)==null?void 0:Ue.paymentInfo)==null?void 0:He.sellerAddress)||u.address;return t.jsx(bs,{title:e.title,onBack:I,payer:d,client:e.client,chain:m,token:y,tokenAmount:h,receiverAddress:F,transactionMode:e.payOptions.mode==="transaction",payOptions:r,isEmbed:e.isEmbed,onDone:p,onTryAgain:()=>{l({id:"buy-with-crypto"})},onSuccess:ae})}if(o.id==="select-currency"){const I=()=>l(o.backScreen);return t.jsx(Fn,{onSelect:M=>{I(),H(M)},onBack:I})}if(o.id==="select-to-token"){const I=a.map(Q=>Q.chain),M=()=>l(o.backScreen),F=(Ve=r==null?void 0:r.prefillBuy)==null?void 0:Ve.allowEdits;return(F==null?void 0:F.token)===!1?t.jsx(vs,{chains:I,client:e.client,connectLocale:e.connectLocale,setChain:k,goBack:M}):t.jsx(Sn,{onBack:M,tokenList:((m!=null&&m.id?W[m.id]:void 0)||[]).filter(Q=>Q.address!==N),onTokenSelect:Q=>{S(Q),M()},chain:m,chainSelection:(F==null?void 0:F.chain)!==!1?{chains:I,select:Q=>{k(Q)}}:void 0,connectLocale:s,client:n,modalTitle:e.title})}return t.jsx(c,{animate:"fadein",children:t.jsxs("div",{children:[o.id==="main"&&t.jsx(As,{title:e.title,payerAccount:d==null?void 0:d.account,client:n,onSelectBuyToken:()=>l({id:"select-to-token",backScreen:o}),payOptions:r,setTokenAmount:x,setToChain:k,setToToken:S,setFromChain:v,setFromToken:O,toChain:m,toToken:y,tokenAmount:h,connectOptions:e.connectOptions,setScreen:l,supportedDestinations:a,onBack:e.onBack,theme:e.theme,hasEditedAmount:A,setHasEditedAmount:j,enabledPaymentMethods:U}),(o.id==="select-payment-method"||o.id==="buy-with-crypto"||o.id==="buy-with-fiat"||o.id==="select-from-token")&&d&&t.jsxs(ps,{disabled:"prefillBuy"in r&&((Ge=(Ke=r.prefillBuy)==null?void 0:Ke.allowEdits)==null?void 0:Ge.amount)===!1||r.mode!=="fund_wallet",title:e.title,selectedChain:m,selectedToken:y,tokenAmount:h,setTokenAmount:x,client:n,onBack:()=>{o.id==="buy-with-crypto"||o.id==="buy-with-fiat"?l({id:"select-from-token",backScreen:{id:"main"}}):o.id==="select-from-token"?l(o.backScreen):l({id:"main"})},children:[o.id==="buy-with-crypto"&&u&&t.jsx(ms,{setScreen:l,tokenAmount:T,toChain:m,toToken:y,fromChain:z,fromToken:R,showFromTokenSelector:()=>{l({id:"select-from-token",backScreen:o})},payer:d,client:n,isEmbed:e.isEmbed,onDone:p,payOptions:r,connectLocale:s,connectOptions:e.connectOptions,setPayer:i,activeAccount:u,setTokenAmount:x,setHasEditedAmount:j,disableTokenSelection:E===!0||r.buyWithCrypto!==!1&&((Ze=(Ye=(Qe=r.buyWithCrypto)==null?void 0:Qe.prefillSource)==null?void 0:Ye.allowEdits)==null?void 0:Ze.chain)===!1&&((et=(Xe=(Je=r.buyWithCrypto)==null?void 0:Je.prefillSource)==null?void 0:Xe.allowEdits)==null?void 0:et.token)===!1}),o.id==="buy-with-fiat"&&t.jsx(Kn,{setScreen:l,tokenAmount:T,toChain:m,toToken:y,selectedCurrency:L,client:n,isEmbed:e.isEmbed,onDone:p,payOptions:r,theme:e.theme,showCurrencySelector:()=>{l({id:"select-currency",backScreen:o})},payer:d,setTokenAmount:x,setHasEditedAmount:j}),o.id==="select-from-token"&&w.data&&g&&t.jsx(xs,{fiatSupported:e.payOptions.buyWithFiat!==!1,client:e.client,sourceTokens:g,sourceSupportedTokens:g,toChain:m,toToken:y,tokenAmount:h,mode:r.mode,hiddenWallets:e.hiddenWallets,onConnect:()=>{l({id:"connect-payer-wallet",backScreen:o})},onPayWithFiat:()=>{l({id:"buy-with-fiat"})},onSelectToken:(I,M,F)=>{const Q=I.getAccount();Q&&(i({account:Q,chain:F,wallet:I}),O(M),v(F)),l({id:"buy-with-crypto"})}})]})]})})}function Ss(e){const n=()=>{const a=$(Number(e.tokenAmount),6).toString();let s=a.replace(".","").length;return a.includes(".")&&(s+=.3),`calc(${`${Math.max(1,s)}ch + 2px`})`};return t.jsx("div",{children:t.jsxs(c,{flex:"row",gap:"sm",center:"y",style:{justifyContent:"space-between"},children:[t.jsxs(c,{flex:"row",gap:"xxs",center:"y",children:[t.jsx(At,{variant:"outline",pattern:"^[0-9]*[.,]?[0-9]*$",inputMode:"decimal",tabIndex:-1,placeholder:"0",type:"text","data-placeholder":e.tokenAmount==="",value:e.tokenAmount||"0",disabled:e.disabled,onClick:a=>{e.tokenAmount===""&&a.currentTarget.setSelectionRange(a.currentTarget.value.length,a.currentTarget.value.length)},onChange:a=>{let s=a.target.value;if(s=s.replace(",","."),s.startsWith(".")&&(s=`0${s}`),s.length>10)return;const r=Number(s);Number.isNaN(r)||(s.startsWith("0")&&!s.startsWith("0.")?e.setTokenAmount(s.slice(1)):e.setTokenAmount(s))},style:{border:"none",fontSize:re.lg,boxShadow:"none",borderRadius:"0",padding:"0",paddingBlock:"2px",fontWeight:600,textAlign:"left",width:n()}}),t.jsxs(c,{flex:"row",gap:"xxs",center:"y",children:[t.jsx(ne,{token:e.selectedToken,chain:e.selectedChain,size:"md",color:"secondaryText"}),t.jsx(Ct,{chain:e.selectedChain,client:e.client,size:"sm",token:e.selectedToken})]}),t.jsx(qe,{chain:e.selectedChain,client:e.client,tokenAmount:e.tokenAmount,token:e.selectedToken,size:"sm"})]}),t.jsx(vn,{chain:e.selectedChain,client:e.client,size:"sm",short:!0})]})})}function As(e){var A,j,p,w,W,g,z,v,R,O,L,H;const{setTokenAmount:n,setToChain:a,setToToken:s,setFromChain:r,setFromToken:u,payerAccount:d,client:i,tokenAmount:o,payOptions:l,toToken:h,toChain:x,supportedDestinations:m,enabledPaymentMethods:k}=e,{buyWithCryptoEnabled:T,buyWithFiatEnabled:y}=k,S=!o;switch(l.mode){case"transaction":return t.jsx(On,{supportedDestinations:m,payUiOptions:l,payerAccount:d,connectOptions:e.connectOptions,client:i,onContinue:(U,E,_)=>{n(U),a(E),r(E),u(_),s(_),y&&!T?e.setScreen({id:"buy-with-fiat"}):e.setScreen({id:"select-from-token",backScreen:{id:"main"}})}});case"direct_payment":return t.jsx(En,{client:i,payUiOptions:l,payerAccount:d,connectOptions:e.connectOptions,supportedDestinations:m,onContinue:(U,E,_)=>{n(U),a(E),r(E),u(_),s(_),y&&!T?e.setScreen({id:"buy-with-fiat"}):e.setScreen({id:"select-from-token",backScreen:{id:"main"}})}});default:return t.jsxs(c,{p:"lg",children:[t.jsx(te,{title:e.title,onBack:e.onBack}),t.jsx(C,{y:"xl"}),t.jsx(us,{value:o,onChange:async U=>{e.setHasEditedAmount(!0),n(U)},freezeAmount:((j=(A=l.prefillBuy)==null?void 0:A.allowEdits)==null?void 0:j.amount)===!1,freezeChainAndToken:((w=(p=l.prefillBuy)==null?void 0:p.allowEdits)==null?void 0:w.chain)===!1&&((g=(W=l.prefillBuy)==null?void 0:W.allowEdits)==null?void 0:g.token)===!1||l.buyWithCrypto!==!1&&((R=(v=(z=l.buyWithCrypto)==null?void 0:z.prefillSource)==null?void 0:v.allowEdits)==null?void 0:R.token)===!1&&((H=(L=(O=l.buyWithCrypto)==null?void 0:O.prefillSource)==null?void 0:L.allowEdits)==null?void 0:H.chain)===!1,token:h,chain:x,onSelectToken:e.onSelectBuyToken,client:e.client}),t.jsx(C,{y:"md"}),t.jsx(c,{flex:"column",gap:"sm",children:d?t.jsx(q,{variant:"accent",fullWidth:!0,disabled:S,"data-disabled":S,onClick:()=>{y&&!T?e.setScreen({id:"buy-with-fiat"}):e.setScreen({id:"select-from-token",backScreen:{id:"main"}})},children:"Continue"}):t.jsx("div",{children:t.jsx(Se,{...e.connectOptions,client:e.client,theme:e.theme,connectButton:{style:{width:"100%"}}})})})]})}}function ps(e){return t.jsxs(c,{children:[t.jsx(c,{p:"lg",children:t.jsx(te,{title:e.title,onBack:e.onBack})}),t.jsxs(c,{px:"lg",style:{paddingBottom:D.lg},children:[t.jsx(C,{y:"xs"}),t.jsx(Ss,{selectedToken:e.selectedToken,selectedChain:e.selectedChain,tokenAmount:e.tokenAmount,setTokenAmount:e.setTokenAmount,client:e.client,disabled:e.disabled}),t.jsx(C,{y:"sm"}),t.jsx(we,{}),t.jsx(C,{y:"sm"}),e.children]})]})}function rt(e,n,a){if(a)return a;const s={},r=n.buyWithFiat===!1,u=n.buyWithCrypto===!1;for(const d of e)s[d.chain.id]=d.tokens.filter(i=>i.buyWithCryptoEnabled===void 0&&i.buyWithFiatEnabled===void 0||i.buyWithCryptoEnabled&&i.buyWithFiatEnabled?!0:!(!i.buyWithCryptoEnabled&&r||!i.buyWithFiatEnabled&&u));return s}function vs(e){return t.jsx(An,{client:e.client,connectLocale:e.connectLocale,showTabs:!1,onBack:e.goBack,chains:e.chains,closeModal:e.goBack,networkSelector:{renderChain(n){return t.jsx(pn,{chain:n.chain,confirming:!1,switchingFailed:!1,onClick:()=>{e.setChain(n.chain),e.goBack()},client:e.client,connectLocale:e.connectLocale})}}})}export{Es as default};
